; Turn
[Statedef 221]
type    = U
anim = ifelse(statetype = S, 5, 6)
ctrl = 0

[State 221, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nowalk

[State 221, Turn]
type = Turn
trigger1 = !time

[State 221, ChangeState]
type = ChangeState
trigger1 = animtime = 0
value = ifelse(statetype = A, 50, 0)
ctrl = 1

; Wall Jump
[Statedef 60]
type = A
physics = A
anim = 60
ctrl = 0

[State 60, 0]
type = Turn
trigger1 = FrontEdgeBodyDist <= 0 && time = 0

[State 60, 1]
type = VelSet
trigger1 = 1
x = 0
y = 0

[State 60, 1]
type = VelSet
trigger1 = AnimTime = 0
x = const(velocity.jump.fwd.x)
y = Const(velocity.jump.y)

[State 60, 2]
type = ChangeState
trigger1 = animtime = 0
value = ifelse(prevstateno = 650, 650,50)
ctrl = ifelse(prevstateno = 650, 0,1)

;---------------------------------------------------------------------------
; Perder por Time Over
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Estado de Vitória
[Statedef 180]
type = S

[State 180, 1]
type = ChangeState
trigger1 = Time = 0
value = 181

;---------------------------------------------------------------------------
; Vitória
[Statedef 181]
type = S
ctrl = 0
velset = 0,0

[State 181, PlaySnd]
type = PlaySnd
trigger1 = !time && roundno = 1
value = S191,0
channel = 10
lowpriority = 1

[State 181, 1]
type = ChangeAnim
trigger1 = sysvar(2) && anim != 162 && anim != ifelse(Life > LifeMax/6,181,5300)
value = 162
sysvar(2) = 0

[State 181, 2]
type = ChangeAnim
trigger1 = !sysvar(2) && anim != ifelse(Life > LifeMax/6,181,5300) && anim != 162
trigger2 = anim = 162 && animtime = 0
value = ifelse(Life > LifeMax/6,181,5300)

[State 180, PalFX]
type = PalFX
triggerall = anim = 181
trigger1 = animelemno(0) = 3
time = 1
add = 0,128,256
mul = 256,256,256
color = 256

[State 181, 3]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Introdução
[Statedef 191]
type = S
ctrl = 0
velset = 0,0

[State 191, ChangeState]
type = ChangeState
trigger1 = time = 1 && name = "SA-X by endoedgarjunior"
value = 194

[State 191, Intro Aleatória]
type = ChangeState
trigger1 = time = 1
value = ifelse(random < 500, 192, 193)

; Load
[Statedef 192]
type = S
ctrl = 0
anim = 190
velset = 0,0

;Generated by Fighter Factory PalFX Editor
[State 192, PalFXWiz]
type = PalFX
trigger1 = (time/2) % 3 = 0 && time <= 226
time = 2
add = 0,128,256
mul = 256,256,256
color = 256
ignorehitpause = 1

;Generated by Fighter Factory PalFX Editor
[State 192, PalFXWiz]
type = PalFX
trigger1 = (time/2) % 3 = 0 && time > 226 && time <= 250
time = 2
add = 0,0,256
mul = 256,256,256
color = 256
ignorehitpause = 1

;Generated by Fighter Factory PalFX Editor
[State 192, PalFXWiz]
type = PalFX
trigger1 = (time/2) % 3 = 0 && time > 250 && time <= 262
time = 2
add = 0,0,128
mul = 256,256,256
color = 256
ignorehitpause = 1

[State 192, Explod]
type = Explod
trigger1 = time = 0
anim = 191
ID = 190+ID
pos = 0,0
postype = p1  ;p2,front,back,left,right
removetime = 226
facing = Facing
scale = Const(size.xscale), Const(size.yscale)
sprpriority = 1
shadow = 0,0,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1
bindtime = -1

[State 192, RemoveExplod]
type = RemoveExplod
trigger1 = animtime = 0
id = 190+ID
ignorehitpause = 1

[State 192, Explod]
type = Explod
trigger1 = time = 226
anim = 192
ID = 192+ID
pos = 0,0
postype = p1  ;p2,front,back,left,right
removetime = -2
facing = Facing
scale = Const(size.xscale), Const(size.yscale)
sprpriority = 1
shadow = 0,0,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1

[State 192, 2]
type = PlaySnd
trigger1 = !time
value = 190,0
channel = 6
persistent = 1

[State 192, 3] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = noMusic
flag2 = Intro

[State 192, ChangeAnim]
type = ChangeAnim
trigger1 = AnimTime = 0 && anim = 190
value = 193
ignorehitpause = 1

[State 192, 4] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0 && anim = 193
value = 0

; Shinespark Intro
[Statedef 193]
type = S
ctrl = 0
anim = 194
velset = 0,0

[State 193, PalFX]
type = PalFX
trigger1 = 1
time = 5
add = 0,128,256
mul = 256,256,256
invertall = 0
color = 256

[State 193, 3]
type = AfterImage
trigger1 = time = 0
time = 25
length = 15
PalBright  = 0,128,256

[State 193, 3]
type = AfterImageTime
trigger1 = 1
time = 15

[State 193, 3] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 193, 4] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0

; SCARY SA-X INTRO
[Statedef 194]
type = S
ctrl = 0

[State 194, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0

[State 194, PosAdd]
type = PosAdd
trigger1 = !time
x = -143;-floor(BackEdgeDist + 50)


[State 194, AssertSpecial]
type = AssertSpecial
trigger1 = time < 170
flag = invisible

[State 194, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = intro
flag2 = nomusic
flag3 = nobardisplay

[State 194, AllPalFX]
type = AllPalFX
trigger1 = time = [60, 70]
add = 256,256,256
time = 1

[State 194, AssertSpecial]
type = AssertSpecial
trigger1 = time = [60, 70]
trigger2 = time = [110, 180]
flag = globalnoshadow


[State 194, PlaySnd]
type = PlaySnd
trigger1 = time = 100
value = S190,0

[State 194, Explod]
type = Explod
trigger1 = time % 4 = 0 && time = [100,120]
anim = 4105
ID = 4105
pos = -BackEdgeDist, -15;50,floor((Screenpos Y)-15)
postype = p1;back  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = 0,-1
random = 15,15
removetime = -2
sprpriority = 1
ontop = 1
shadow = -1,-1,-1
ownpal = 1

[State 194, Explod]
type = Explod
trigger1 = time % 4 = 0 && time = [120,140]
anim = 303
ID = 4105
pos = -BackEdgeDist, -30;50,floor((Screenpos Y)-30)
postype = p1;back  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = 0,-1
random = 15,15
removetime = -2
sprpriority = 1
ontop = 1
shadow = -1,-1,-1
ownpal = 1

[State 194, AllPalFX]
type = AllPalFX
trigger1 = time = [110, 150]
time = 1
add = floor(((time-110.0)/40.0)*256),floor(((time-110.0)/40.0)*256),floor(((time-110.0)/40.0)*256)

[State 194, AllPalFX]
type = AllPalFX
trigger1 = time = [150, 170]
time = 1
add = 256,256,256

[State 194, AllPalFX]
type = AllPalFX
trigger1 = time = [170, 180]
time = 1
add = 256-floor(((time-170.0)/10.0)*256),256-floor(((time-170.0)/10.0)*256),256-floor(((time-170.0)/10.0)*256)

[State 194, ChangeAnim]
type = ChangeAnim
trigger1 = anim != 20 && !time
value = 20

[State 174, VarSet]
type = VelSet
trigger1 = anim = 20
x = Const(velocity.run.fwd.x)/8

[State 174, VarSet]
type = VelSet
trigger1 = anim != 20
x = 0

[State 174, PlaySnd]
type = PlaySnd
trigger1 = (animelem = 4 || animelem = 9) && anim = 20 && time > 180
value = S40,0
channel = 0

[State 174, ChangeAnim]
type = ChangeAnim
trigger1 = time = 380 && anim
value = 0

[State 174, ChangeAnim]
type = ChangeAnim
trigger1 = time = 440 && anim != 181
value = 181

[State 174, Helper]
type = Helper
trigger1 = anim = 181 && animtime = 0 && !numhelper(175)
helpertype = normal ;player
name = "Cutscene"
ID = 175
stateno = 254
pos = floor(-ScreenPos X)*facing,floor(-ScreenPos Y)
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 99999
pausemovetime = 99999
size.xscale = 0.5
size.yscale = 0.5

[State 174, ChangeAnim]
type = ChangeAnim
trigger1 = anim && numhelper(175)
value = 0

[State 174, ChangeState]
type = ChangeState
trigger1 = anim = 0 && !numhelper(175) && time > 500
value = 0

; SCARY SA-X CUTSCENE
[Statedef 254]
type = S
ctrl = 0
anim = 180
velset = 0,0
sprpriority = 5

[State 175, SprPriority]
type = SprPriority
trigger1 = 1
value = 5
ignorehitpause = 1

[State 175, PosAdd]
type = PosAdd
trigger1 = !time && facing = -1
x = -320

[State 175, PlaySnd]
type = PlaySnd
trigger1 = time = 20
value = S190,1

[State 175, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = intro
flag2 = noBG
flag3 = noFG

[State 175, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
flag = globalnoshadow

[State 175, DestroySelf]
type = DestroySelf
trigger1 = animtime = 0


;---------------------------------------------------------------------------
; Provocação
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 0

[State 195, Explod]
type = Explod
trigger1 = !numexplod(19114)
anim = 191
ID = 19114
bindtime = -1
removetime = -2
scale = Const(size.xscale), Const(size.yscale)
shadow = -1,-1,-1
sprpriority = 1
ownpal = 1
removeongethit = 1

[State 195, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nomusic

[State 195, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S195,0
channel = 0
lowpriority = 1

[State 195, PowerAdd]
type = PowerAdd
trigger1 = 1
value = 5

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

; Surpreender
[Statedef 198]
type = S
ctrl = 0
velset = 0,0
movetype = I
physics = S
sprpriority = -2

[State 198, ChangeAnim]
type = ChangeAnim
trigger1 = !sysvar(2) && anim != 160 && time = 0
value = 160

[State 198, PlayerPush]
type = PlayerPush
trigger1 = anim = 161
value = 0

[State 198, NotHitBy]
type = NotHitBy
trigger1 = anim = 161
value = SCA

[State 198, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 160 && animtime = 0
value = 161

[State 198, VelSet]
type = VelSet
trigger1 = anim = 161
x = 5
y = 0

[State 198, VelSet]
type = VelSet
trigger1 = anim != 161
x = 0
y = 0

[State 198, ChangeAnim]
type = ChangeAnim
trigger1 = (anim = 161 && P2BodyDist X < -30 && !sysvar(2)) || roundstate != 2 || time = 120
value = 162
persistent = 0

[State 198, RestoreState]
type = ChangeState
trigger1 = anim = 162 && animtime = 0 && !sysvar(2)
trigger2 = time > 25 && sysvar(2)
trigger3 = FrontEdgeBodyDist <= 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Ice Spazer Attack
[StateDef 200]
ctrl = ifelse(statetype = A, 1, 0)
type = U
movetype = A
physics = U
poweradd = 70
juggle = 1

[State 200, Explod]
type = Explod
trigger1 = name != "Samus Aran by endoedgarjunior" && !numexplod(239) && !time
anim = 239
ID = 239
pos = floor(15*Const(size.xscale)),floor((-21 + (ifelse(statetype = C,9,ifelse(statetype = A, -3, 0))))*Const(size.yscale))
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
removetime = -2
scale = 1,1
sprpriority = 1
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0

[State 200, VarAdd]
type = VarAdd
trigger1 = time = 0
v = 3
value = 150
ignorehitpause = 1

[State 200, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noautoturn

[State 200, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0 && !sysvar(2)
value = ifelse(statetype = S,ifelse(prevstateno = 100 || prevstateno = 20,100,3700),ifelse(statetype = C, 11,630))
elem = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,var(30),0),0)

[State 200, 5]
type = VarSet
trigger1 = var(30) != AnimElemNo(1)
var(30) = AnimElemNo(1)

[State 200, VelSet]
type = VelSet
trigger1 = statetype != A && prevstateno != 100 && prevstateno != 20
x = 0
y = 0

[State 200, StateTypeSet]
type = StateTypeSet
trigger1 = statetype = A
statetype = A       ;S,A,C,L
movetype = A        ;I,A,H
physics = A         ;A,C,S,N

[State 200, 1]
type = PlaySnd
trigger1 = time = 1
value = 0,1
channel = 0

[State 200, Helper]
type = Helper
trigger1 = name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Ice Beam"
ID = 19999
stateno = 201
pos = floor(-6*Const(size.xscale)),floor((-26 + (ifelse(statetype = C,11,ifelse(statetype = A, 5, 0))))*Const(size.xscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Ice Beam"
ID = 20001
stateno = 201
pos = floor(-6*Const(size.xscale)),floor((-26 + (ifelse(statetype = C,11,ifelse(statetype = A, 5, 0))))*Const(size.xscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

;[State 210, Helper]
;type = Helper
;trigger1 = name != "Samus Aran by endoedgarjunior"
;helpertype = normal ;player
;name = "Ice Beam"
;ID = 20000
;stateno = 201
;pos = floor(-6*Const(size.xscale)),floor((-26 + (ifelse(statetype = C,11,ifelse(statetype = A, 5, 0))))*Const(size.xscale))
;postype = p1    ;p2,front,back,left,right
;facing = 1
;keyctrl = 0
;ownpal = 1
;persistent = 0
;size.xscale = Const(size.xscale)
;size.yscale = Const(size.xscale)
;persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Ice Beam"
ID = 19999
stateno = 201
pos = 0,floor((-21 + (ifelse(statetype = C,9,ifelse(statetype = A, -3, 0))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Ice Beam"
ID = 20001
stateno = 201
pos = 0,floor((-21 + (ifelse(statetype = C,9,ifelse(statetype = A, -3, 0))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Ice Beam"
ID = 20000
stateno = 201
pos = 0,floor((-21 + (ifelse(statetype = C,9,ifelse(statetype = A, -3, 0))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

;[State 200, 2]
;type = Projectile
;trigger1 = 1
;hitflag = MAFDP
;projanim = ifelse(var(0) < 100, 234, 236)
;guardsound = 6,0
;offset = 10*Const(size.xscale),(-26 + (ifelse(statetype = C,11,0)))*Const(size.xscale)
;projscale = Const(size.xscale),Const(size.yscale)
;velocity = 4,0
;projid = 3+ID
;velmul = 1.01, 1
;attr = S, NP
;damage = 2, 1
;p2stateno = 1000
;pausetime = 0,90
;guard.pausetime = 60, 60
;sparkno = S4102
;guard.sparkno = S4103
;sparkxy = 24, 0
;hitsound = S1000,0
;guardsound = S270, 0
;guardflag = MA
;persistent = 0
;projhits = ifelse(var(0) > 100, var(0)/20,1)

[State 200, VarSet]
type = VarSet
trigger1 = var(0) > 0
v = 0    ;fv = 10
value = 0

;[State 200, ChangeState]
;type = ChangeState
;trigger1 = AnimTime = 0 && statetype != A
;trigger2 = statetype = A && Pos Y >= 0
;trigger3 = anim = 100 && time > 2
;value = ifelse(statetype != C,ifelse(statetype = S && anim = 100,20,0),11)
;ctrl = 1

[State 230, 3]
type = ChangeState
trigger1 = statetype != A || (anim = 3700 && AnimTime = 0)
trigger2 = statetype = A && Pos Y >= 0
trigger3 = anim = 100 && time > 2
value = ifelse(statetype != C,ifelse(statetype = S && anim = 100,20,0),11)
ctrl = 1

[StateDef 201]
type = S
movetype = A
physics = N
juggle = 1
anim = ifelse(!parent, IsHelper, ifelse(IsHelper(19999) || IsHelper(20000) || IsHelper(20001), 234, 231), 236)

[State 201, AssertSpecial]
type = AssertSpecial
triggerall = root, name = "SA-X by endoedgarjunior"
trigger1 = IsHelper(19999) && time%3 != 0
trigger2 = IsHelper(20000) && (time+1)%3 != 0
trigger3 = IsHelper(20001) && (time+2)%3 != 0
flag = invisible
ignorehitpause = 1

[State 201, VelSet]
type = VelSet
trigger1 = time = 0
x = abs(root, vel X) + 4
ignorehitpause = 1

[State 201, VarAdd]
type = VarAdd
trigger1 = time % 2 = 0 && time > 7
v = 7
value = 1
ignorehitpause = 1

[State 201, VelSet]
type = PosSet
trigger1 = (IsHelper(19999) || IsHelper(29999)) && (root, name != "SA-X by endoedgarjunior" || time < 15)
y = Pos Y + sin(var(7)/PI*180.0)*4.0
ignorehitpause =  1

[State 201, VelSet]
type = PosSet
trigger1 = (IsHelper(20001) || IsHelper(30001)) && (root, name != "SA-X by endoedgarjunior" || time < 15)
y = Pos Y - sin(var(7)/PI*180.0)*4.0
ignorehitpause =  1

[State 201, VelMul]
type = VelMul
trigger1 = 1
x = 1.01
ignorehitpause = 1

[State 201, VarSet]
type = VarSet
trigger1 = time = 0
fv = 0
value = Const(size.xscale)
ignorehitpause = 1

[State 201, HitDef]
type = HitDef
trigger1 = time % 2 = 0
hitflag = MAFDP
attr = S, NP
sparkno = -1
guard.sparkno = -1
damage = ifelse(anim = 236, 10,2), 1
pausetime = 0,ifelse((anim = 234 || (anim = 236 && (name = "SA-X by endoedgarjunior" || name = "Samus Aran by endoedgarjunior"))), 90, 0)
guard.pausetime = 0, ifelse(anim = 234, 60, 0)
hitsound = 5,ifelse(anim = 236, 4, 0);Sifelse((anim = 234 || (anim = 236 && (name = "SA-X by endoedgarjunior" || name = "Samus Aran by endoedgarjunior"))), 1000, 0),0
ground.velocity = ifelse(anim = 234, 0, -1)*((anim = 236)+1),  ifelse(anim = 234, 0, -2)
air.velocity = ifelse(anim = 234, 0, -1)*((anim = 236)+1),  ifelse(anim = 234, 0, -2)
guardsound = S270, 0
ground.type = Low
air.type = Low
guardflag = MA
airguard.velocity = 0,0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0

[State 201, TargetState]
type = TargetState
trigger1 = movehit && numtarget && (anim = 234 || (anim = 236 && (name = "SA-X by endoedgarjunior" || name = "Samus Aran by endoedgarjunior")))
value = 1000

[State 201, Explod]
type = Explod
trigger1 = name != "SA-X by endoedgarjunior"
trigger1 = time % floor((3*fvar(0))) = 0 && !var(0) && (!IsHelper(20000) ||  name != "Samus Aran by endoedgarjunior") && time >= 6
trigger1 = anim != 231
anim = ifelse(anim = 234 || (name = "Samus Aran by endoedgarjunior" && anim = 236), 4106, 240)
ID = 4106
pos = 0,0
vel = 0, ifelse(name = "Samus Aran by endoedgarjunior", 0.5, 0)
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale), Const(size.yscale)
sprpriority = -1
shadow = -1,-1,-1
ownpal = 1
removeongethit = 0
ignorehitpause = 1

[State 201, Explod]
type = Explod
trigger1 = movecontact && name != "Samus Aran by endoedgarjunior"
anim = ifelse(moveguarded, 4103, ifelse((anim = 234 || (anim = 236 && name = "SA-X by endoedgarjunior")), 4102, 4108))
ID = 4102+ID
pos = 12,0
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale),  Const(size.yscale)
vel = ifelse(!moveguarded, (-1000+random+random)/500, 0), ifelse(!moveguarded, -1, 0)
sprpriority = 1
ownpal = 1
ignorehitpause = 1

[State 201, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 201, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "id = %d"
params = ID
ignorehitpause = 1

[State 201, DestroySelf]
type = DestroySelf
trigger1 = FrontEdgeBodyDist < 0 || screenPos Y >= 300
ignorehitpause = 1

[State 201, MoveHitReset]
type = MoveHitReset
trigger1 = 1
ignorehitpause = 1

; Missile Shot
[StateDef 210]
ctrl = 1;ifelse(statetype = A, 1, 0)
type = U
movetype = A
physics = U
poweradd = 20
juggle = 1

[State 200, VarAdd]
type = VarAdd
trigger1 = time = 0
v = 3
value = 50
ignorehitpause = 1

[State 210, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noautoturn
flag2 = nowalk

[State 210, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0 && name != "SA-X by endoedgarjunior"
value = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,100,210), ifelse(statetype = C,13,631))
elem = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,var(30),0),0)

[State 210, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0 && name = "SA-X by endoedgarjunior"
value = ifelse(statetype = S, 210, ifelse(statetype = C,13,631))
elem = 0

[State 210, VelMul]
type = VelMul
trigger1 = name = "SA-X by endoedgarjunior" && statetype != A
x = ifelse(statetype = S, Const(movement.stand.friction), Const(movement.crouch.friction))


[State 210, VarSet]
type = VarSet
trigger1 = var(30) != AnimElemNo(1)
var(30) = AnimElemNo(1)

[State 210, VelSet]
type = VelSet
trigger1 = statetype != A && prevstateno != 100 && prevstateno != 20
x = 0
y = 0

[State 210, StateTypeSet]
type = StateTypeSet
trigger1 = statetype = A
statetype = A
movetype = A
physics = A

[State 210, 1]
type = PlaySnd
trigger1 = 1
value = 0,2
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Missile"
ID = 2+ID
stateno = 211
pos = floor(13*Const(size.xscale)),floor((-25 + (ifelse(statetype = C,11,ifelse(anim = 100,-4,ifelse(statetype = A, 5, 0)))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name = "Samus Aran (Fusion) by endoedgarjunior"
helpertype = normal ;player
name = "Missile"
ID = 2+ID
stateno = 211
pos = floor(9*Const(size.xscale)),floor((-21 + (ifelse(statetype = C,9,ifelse(anim = 100,0,ifelse(statetype = A, -2, 0)))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name = "SA-X by endoedgarjunior"
helpertype = normal ;player
name = "Missile"
ID = 2+ID
stateno = 211
pos = floor(-8*Const(size.xscale)),floor((-21 + (ifelse(statetype = C,7,ifelse(anim = 100,-4,ifelse(statetype = A, 5, 0)))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, 3]
type = ChangeState
trigger1 = AnimTime = 0 && statetype != A
trigger2 = statetype = A && Pos Y >= 0
trigger3 = anim = 100 && time > 2
value = ifelse(statetype != C,ifelse(statetype = S && anim = 100,20,0),11)
ctrl = 1

; Missile Helper
[StateDef 211]
type = S
movetype = A
physics = N
juggle = 1
anim = 233


[State 211, VelSet]
type = VelSet
trigger1 = time = 0
x = abs(root, vel x)+1
y = 0
ignorehitpause = 1

[State 211, VelAdd]
type = Velmul
trigger1 = 1
x = 1.05

[State 211, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
stateno = 211
time = 1
ignorehitpause = 1

[State 211, VelMul]
type = VelMul
trigger1 = 1
x = 1.01
ignorehitpause = 1

[State 211, VarSet]
type = VarSet
trigger1 = time = 0
fv = 0
value = Const(size.xscale)
ignorehitpause = 1

[State 211, Explod]
type = Explod
trigger1 = name != "SA-X by endoedgarjunior"

trigger1 = time % floor((2*fvar(0))) = 0 && !var(0)
anim = 4104
ID = 4104
pos = 0,0
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale), Const(size.yscale)
sprpriority = 1
ownpal = 1
random = 5*(name = "Samus Aran (Fusion) by endoedgarjunior"), 5*(name = "Samus Aran (Fusion) by endoedgarjunior")
shadow = -1,-1,-1
removeongethit = 0
ignorehitpause = 1

[State 211, HitDef]
type = HitDef
trigger1 = !movecontact
hitflag = MAFDP
attr = S, SP
damage = 50, 2
sparkno = -1
animtype = Medium
pausetime = 0,9
sparkno = 0
sparkxy = 8, 0
hitsound = S300, 0
guardsound = S270, 0
guardflag = MA
guardsound = 6,0
ground.type = Trip
ground.slidetime = 14
ground.hittime = 16
ground.velocity = -8
air.animtype = Back
air.velocity = -2.5,-5
air.juggle = 3
persistent = 0

[State 211, Explod]
type = Explod
trigger1 = movecontact ||  Pos Y >= 0

anim = ifelse(movehit || Pos Y >= 0, 4105, 4103)
ID = 4105+ID
pos = ifelse(Pos Y >= 0, 0, 8),0
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale),  Const(size.yscale)
sprpriority = 1
ownpal = 1
ignorehitpause = 1

[State 211, PlaySnd]
type = PlaySnd
trigger1 = Pos Y >= 0
value = S300,0
ignorehitpause = 1

[State 211, VarSet]
type = VarSet
trigger1 = moveguarded || GetHitVar(damage) > 0
v = 0
value = 1 ; Missel vai voltar girando
ignorehitpause = 1

[State 211, VelSet]
type = VelSet
trigger1 = var(0)
x = 0
y = -5
ignorehitpause = 1
persistent = 0

[State 211, ChangeAnim]
type = ChangeAnim
trigger1 = var(0) && anim != 238
value = 238
ignorehitpause = 1

[State 211, AngleAdd]
type = AngleAdd
trigger1 = var(0)
value = 5*root,Facing

[State 211, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 211, Gravity]
type = Gravity
trigger1 = var(0)
ignorehitpause = 1

[State 211, AngleDraw]
type = AngleDraw
trigger1 = 1
ignorehitpause = 1

[State 211, DestroySelf]
type = DestroySelf
trigger1 = movehit || FrontEdgeBodyDist < 0 || Pos Y >= 0
ignorehitpause = 1

[State 241, MoveHitReset]
type = MoveHitReset
trigger1 = movecontact
ignorehitpause = 1

; Power Beam Shot
[Statedef 230]
ctrl = ifelse(statetype = A, 1, 0)
type = U
movetype = A
physics = U
poweradd = 20
juggle = 1

[State 230, ChangeState]
type = ChangeState
trigger1 = name = "SA-X by endoedgarjunior" || name = "Samus Aran by endoedgarjunior"
value = 200

[State 230, VarAdd]
type = VarAdd
trigger1 = time = 0
v = 3
value = 50
ignorehitpause = 1

[State 230, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noautoturn

[State 230, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0
value = ifelse(statetype = S,ifelse(prevstateno = 0, 3700,ifelse(prevstateno = 100 || prevstateno = 20,100,0)),ifelse(statetype = C, 11,630))
elem = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,var(30),0),0)

[State 230, 5]
type = VarSet
trigger1 = var(30) != AnimElemNo(1)
var(30) = AnimElemNo(1)

[State 230, VelSet]
type = VelSet
trigger1 = statetype != A && prevstateno != 100 && prevstateno != 20
x = 0
y = 0

[State 230, StateTypeSet]
type = StateTypeSet
trigger1 = statetype = A
statetype = A
movetype = A
physics = A

[State 230, 1]
type = PlaySnd
trigger1 = 1
value = 0,0
persistent = 0

[State 200, Helper]
type = Helper
trigger1 = name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Wave Beam"
ID = 29999
stateno = 201
pos = floor(-6*Const(size.xscale)),floor((-26 + (ifelse(statetype = C,11,ifelse(statetype = A, 5, 0))))*Const(size.xscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Wave Beam"
ID = 30001
stateno = 201
pos = floor(-6*Const(size.xscale)),floor((-26 + (ifelse(statetype = C,11,ifelse(statetype = A, 5, 0))))*Const(size.xscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Wave Beam"
ID = 30000
stateno = 201
pos = floor(-6*Const(size.xscale)),floor((-26 + (ifelse(statetype = C,11,ifelse(statetype = A, 5, 0))))*Const(size.xscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Wave Beam"
ID = 29999
stateno = 201
pos = 0,floor((-21 + (ifelse(statetype = C,9,ifelse(statetype = A, -3, 0))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Wave Beam"
ID = 30001
stateno = 201
pos = 0,floor((-21 + (ifelse(statetype = C,9,ifelse(statetype = A, -3, 0))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Wave Beam"
ID = 30000
stateno = 201
pos = 0,floor((-21 + (ifelse(statetype = C,9,ifelse(statetype = A, -3, 0))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 230, 3]
type = ChangeState
trigger1 = statetype != A || (anim = 3700 && AnimTime = 0)
trigger2 = statetype = A && Pos Y >= 0
trigger3 = anim = 100 && time > 2
value = ifelse(statetype != C,ifelse(statetype = S && anim = 100,20,0),11)
ctrl = 1


; Plasma Beam Shot
[StateDef 236]
anim = 0
ctrl = 0
type = S
movetype = A
physics = S
velset = -8,0
juggle = 1

[State 236, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noautoturn

[State 236, Super A]
type = SuperPause
trigger1 = AnimElem = 1
time = 20
pos = 25, -15
anim = 0
poweradd = -1000

[State 236, PlaySND]
type = PlaySnd
trigger1 = AnimElem = 1
value = 236, 0

[State 236, 1]
type = Projectile
trigger1 = AnimElem = 1
ProjID = 10
projanim = 236
projhitanim = 4102
projcancelanim = 4103
offset = 10*Const(size.xscale),-25*Const(size.yscale)
projscale = Const(size.xscale),Const(size.yscale)
velocity = 6,0
velmul = 1.01, 1
attr = S, SP
damage = 20, 5
animtype = Medium
p2stateno = 1000
guard.pausetime = 0, 0
guardsound = S270, 0
sparkno = S4102
guard.sparkno = S4103
projhits = 999
sparkxy = 40, 0
hitsound = S1000,0
hitflag = MAFDP
guardflag = MA
guardsound = 6,0
ground.type = Low
ground.slidetime = 14
ground.hittime = 16
ground.velocity = -8
air.animtype = Back
air.velocity = -2.5,-5
air.juggle = 3
palfx.time = 80
palfx.add = 0, 128, 255

[State 236, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

; SMissile Shot
[StateDef 240]
ctrl = 1;ifelse(statetype = A, 1, 0)
type = U
movetype = A
physics = U
poweradd = 20
juggle = 1

[State 240, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA
stateno = 240
time = 1
ignorehitpause = 1

[State 240, DestroySelf]
type = DestroySelf
trigger1 = var(3) > 30 && time = 0
ignorehitpause = 1

[State 240, VarAdd]
type = VarAdd
trigger1 = time = 0
v = 3
value = 250
ignorehitpause = 1

[State 240, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noautoturn
flag2 = nowalk

[State 240, VarSet]
type = VarSet
trigger1 = var(30) != AnimElemNo(1)
var(30) = AnimElemNo(1)

;[State 240, ChangeAnim]
;type = ChangeAnim
;trigger1 = time = 0
;value = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,100,210), ifelse(statetype = C,13,631))
;elem = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,var(30),0),0)

[State 210, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0 && name != "SA-X by endoedgarjunior"
value = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,100,210), ifelse(statetype = C,13,631))
elem = ifelse(statetype = S, ifelse(prevstateno = 100 || prevstateno = 20,var(30),0),0)

[State 210, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0 && name = "SA-X by endoedgarjunior"
value = ifelse(statetype = S, 210, ifelse(statetype = C,13,631))
elem = 0

;[State 210, VelMul]
;type = VelMul
;trigger1 = name = "SA-X by endoedgarjunior" && statetype != A
;x = ifelse(statetype = S, Const(movement.stand.friction), Const(movement.crouch.friction))

[State 240, VelSet]
type = VelSet
trigger1 = statetype != A && prevstateno != 100 && prevstateno != 20 && time = 0
x = -6
y = 0

[State 240, StateTypeSet]
type = StateTypeSet
trigger1 = statetype = A
statetype = A
movetype = A
physics = A

[State 240, 1]
type = PlaySnd
trigger1 = 1
value = 0,3
persistent = 0

[State 240, Helper]
type = Helper
trigger1 = name != "SA-X by endoedgarjunior"
helpertype = normal ;player
name = "Super Missile"
ID = 4+ID
stateno = 241
pos = floor(10*Const(size.xscale)),floor((-25 + (ifelse(statetype = C,11,ifelse(anim = 100,-4,ifelse(statetype = A, 5, 0)))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = name = "SA-X by endoedgarjunior"
helpertype = normal ;player
name = "Super Missile"
ID = 4+ID
stateno = 241
pos = floor(-8*Const(size.xscale)),floor((-21 + (ifelse(statetype = C,7,ifelse(anim = 100,-4,ifelse(statetype = A, 5, 0)))))*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 240, 3]
type = ChangeState
trigger1 = statetype != A && animtime = 0
trigger2 = statetype = A && Pos Y >= 0
trigger3 = anim = 100 && time > 2
value = ifelse(statetype != C,ifelse(statetype = S && anim = 100,20,0),11)
ctrl = 1

[StateDef 241]
type = S
movetype = A
physics = N
juggle = 1
anim = 235

[State 241, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
stateno = 241
time = 1
ignorehitpause = 1

[State 241, VelSet]
type = VelSet
trigger1 = time = 0
x = 8
y = 0
ignorehitpause = 1

[State 241, VelMul]
type = VelMul
trigger1 = 1
x = 1.04
ignorehitpause = 1

[State 241, VarSet]
type = VarSet
trigger1 = time = 0
fv = 0
value = Const(size.xscale)
ignorehitpause = 1

[State 241, Explod]
type = Explod
trigger1 = name != "SA-X by endoedgarjunior"
trigger1 = time % floor((2*fvar(0))) = 0 && !var(0)
anim = ifelse(selfanimexist(4107), 4107, 4104)
ID = 4104
pos = 0,0
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale), Const(size.yscale)
sprpriority = 1
ownpal = 1
shadow = -1,-1,-1
removeongethit = 0
ignorehitpause = 1

[State 241, HitDef]
type = HitDef
trigger1 = !movecontact
hitflag = MAFDP ; LOL 18/08/08 2:53 N
attr = S, SP
damage = 200, 5
sparkno = -1
animtype = Hard
pausetime = 0,30
sparkno = 0
sparkxy = 0, 0
hitsound = S300, 0
guardsound = S270, 0
guardflag = MA
guardsound = 6,0
ground.type = Hard
ground.slidetime = 14
ground.hittime = 16
guardsound = S270, 0
ground.velocity = -vel x
guard.velocity = 0
fall = 1
air.animtype = Back
air.velocity = -vel x
air.juggle = 3
persistent = 0
;projshadow = -1,-1,-1
;projedgebound = 150

[State 241, EnvShake]
type = EnvShake
trigger1 = movehit || Pos Y >= 0
time = 30           ;Parameters for shaking the screen on hit
ampl = 7
freq = 176
ignorehitpause = 1

[State 241, Explod]
type = Explod
trigger1 = movecontact || Pos Y >= 0
anim = ifelse(movehit || Pos Y >= 0, 4101, 4103)
ID = 4101+ID
pos = ifelse(Pos Y >= 0, 0, 8),0
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale),  Const(size.yscale)
sprpriority = 1
ownpal = 1
ignorehitpause = 1

[State 241, PlaySnd]
type = PlaySnd
trigger1 = Pos Y >= 0
value = S300,0
ignorehitpause = 1

[State 241, VarSet]
type = VarSet
trigger1 = moveguarded || GetHitVar(damage) > 0
v = 0
value = 1 ; Missel vai voltar girando
ignorehitpause = 1

[State 241, VelSet]
type = VelSet
trigger1 = var(0)
x = 0
y = -5
ignorehitpause = 1
persistent = 0

[State 241, ChangeAnim]
type = ChangeAnim
trigger1 = var(0) && anim != 237
value = 237
ignorehitpause = 1

[State 241, AngleAdd]
type = AngleAdd
trigger1 = var(0)
value = -5*Facing

[State 241, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 241, Gravity]
type = Gravity
trigger1 = var(0)
ignorehitpause = 1

[State 241, AngleDraw]
type = AngleDraw
trigger1 = 1
ignorehitpause = 1

[State 241, DestroySelf]
type = DestroySelf
trigger1 = movehit || FrontEdgeBodyDist < 0 || Pos Y >= 0
ignorehitpause = 1

[State 241, MoveHitReset]
type = MoveHitReset
trigger1 = movecontact
ignorehitpause = 1


; Soltar Bomba
[StateDef 300]
ctrl = 0
type = S
movetype = A
physics = S
poweradd = 20
juggle = 1

[State 300, StateTypeSet]
type = StateTypeSet
trigger1 = Pos Y < 0
statetype = A       ;S,A,C,L
movetype = A        ;I,A,H
physics = A         ;A,C,S,N

[State 300, Projectile]
type = Projectile
trigger1 = Time = 0
ProjID = 300
projanim = 300
projscale = Const(size.xscale),Const(size.yscale)
projremove = 1
projremovetime = 140
velocity = 0,0
projpriority = 1
projsprpriority = 3
projedgebound = 40
projstagebound = 40
projheightbound = -240
offset = 0,0
postype = p1         ;p2,front,back,left,right
projshadow = 0,0,0
supermovetime = 0
pausemovetime = 0
; HitDef
attr = S,NA        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
givepower = 5,0
animtype = light          ;light,medium,hard,back,up,diagup
air.animtype = light
priority = 4,Hit   ;Hit,Miss,Dodge
damage = 20,10
pausetime = 0,5
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
hitsound = 0,0
guardsound = 0,0
ground.type = Low      ;Low,Trip,None
ground.slide = 0
ground.hit = 0
air.hittime = 20
ground.velocity = 0,0
air.velocity = 0,0
sprpriority = 1
p1getp2facing = 0
fall = 0
fall.yvelocity = -4.5
fall.recover = 1
fall.recovertime = 4
fall.damage = 0
down.bounce = 0
kill = 1
guard.kill = 1
fall.kill = 1
numhits = 1
palfx.time = 5
palfx.mul = 256,256,256
palfx.add = 256,256,256
projhits = 999

[State 300, Helper]
type = Helper
trigger1 = Time = 0
helpertype = normal ;player
name = "Bomb"
ID = 300
stateno = 301
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1

[State 300, RestoreState]
type = ChangeState
trigger1 = 1
value = ifelse(Pos Y >= 0, 0, 50)
ctrl = 1

[StateDef 301]
anim = 301
ctrl = 0
type = S
movetype = A
physics = S
velset = 0,0
juggle = 1

[State 301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 13
value = 300,0

[State 301, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = invisible

[State 301, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

[State 301, HitDef]
type = HitDef
trigger1 = 1
attr = S,NP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
affectteam = F          ;B,E,F
priority = 4,Miss   ;Hit,Miss,Dodge
sparkno = -1
persistent = 0
ground.velocity = root, vel X,root, Const(velocity.jump.y)

[State 301, DestroySelf]
type = DestroySelf
trigger1 = AnimTime = 0

[StateDef 305]
anim = 304
type = S
movetype = I
physics = N
sprpriority = 1

[State 305, AssertSpecial]
type = AssertSpecial
trigger1 = root, anim = 42 || root, stateno = 650
flag = invisible

[State 305, PlaySnd]
type = PlaySnd
trigger1 = !time
value = S0,4
channel = 0

[State 305, PlaySnd]
type = PlaySnd
trigger1 = anim = 304 && !animtime
value = S0,5
loop = 1
channel = 0

[State 305, PalFX]
type = PalFX
trigger1 = root, name = "SA-X by endoedgarjunior"
time = 1
add = 0,128,128
mul = 256,256,256
color = 0

[State 305, BindToRoot]
type = BindToRoot
trigger1 = root, name != "Samus Aran by endoedgarjunior"
time = 1
facing = 1
pos = floor((15+ifelse(root, statetype = A, 3, 0))*Const(size.xscale)),floor((-21 + (ifelse(root, statetype = C,7,ifelse(root, statetype = A, 0, 0))))*Const(size.yscale))
;pos = 15,-21

[State 305, BindToRoot]
type = BindToRoot
trigger1 = root, name = "Samus Aran by endoedgarjunior"
time = 1
facing = 1
pos = floor((15+ifelse(root, statetype = A, -3, ifelse(root, anim = 100, 8, 0)))*Const(size.xscale)),floor((-26 + (ifelse(root, statetype = C,10,ifelse(root, statetype = A, 7, ifelse(root, anim = 100, -3, 0)))))*Const(size.yscale))
;pos = 15,-21

[State 305, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 304 && !animtime
value = 305

[State 210, Helper]
type = Helper
trigger1 = var(0) && name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Beam"
ID = 19999
stateno = 201
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = var(0) && name = "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Beam"
ID = 20001
stateno = 201
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = var(0) && name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Beam"
ID = 20000
stateno = 201
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = var(0) && name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Beam"
ID = 19999
stateno = 201
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = var(0) && name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Beam"
ID = 20001
stateno = 201
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, Helper]
type = Helper
trigger1 = var(0) && name != "Samus Aran by endoedgarjunior"
helpertype = normal ;player
name = "Beam"
ID = 20000
stateno = 201
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.xscale)
persistent = 0

[State 210, StopSnd]
type = StopSnd
trigger1 = var(0) && anim = 239 && animtime = 0
trigger2 = root, command != "holda" && anim = 304
trigger3 = root, movetype != I && root, stateno != 650
channel = 0

[State 210, StopSnd]
type = PlaySnd
trigger1 = var(0) && anim = 239 && animtime = 0
value = S0, 6

[State 210, DestroySelf]
type = DestroySelf
trigger1 = var(0) && anim = 239 && animtime = 0
trigger2 = root, command != "holda" && anim = 304 && !root, var(59)
trigger3 = root, movetype != I && root, stateno != 650

[State 210, ChangeAnim]
type = ChangeAnim
trigger1 = var(0) && anim != 239
value = 239

[State 210, VarSet]
type = VarSet
trigger1 = root, command != "holda" && anim = 305
v = 0
value = 1

[State 210, VarSet]
type = VarSet
triggerall = root, var(42) >= 0 && !(time % 5) && anim = 305
triggerall = RoundState = 2 && root, var(59) && root, StateType != L && root, MoveType != H && (root, Ctrl || (root, stateno = 60 || root, stateno = 650)) && root, Alive && !root, sysvar(2)
triggerall = (root, pos y - enemynear(root, var(42)), pos Y) <= enemynear(root, var(42)), Const(size.height)/2 && (enemynear(root, var(42)), pos y - root, pos Y) <= Const(size.height)/4 && P2Dist X > 0
trigger1 = (P2StateType != L ) || (random < 20) || root, prevstateno = 198 || P2Name = "Kraken" || P2Name = "Apocalypse"
trigger2 = P2Name = "Samus Aran" || P2Name = "Samus Aran by Jupiter" || ProjHit = 1, < 15 = 1 && numexplod(400+ID) > 0
trigger3 = root, ProjContact = 1, < 30
v = 0
value = 1

;-------------------------------------------------------
; Screw Attack
[StateDef 650]
anim = 650
ctrl = ifelse(var(59),0,1)
type = A
movetype = A
physics = A

[State 650, ChangeState]
type = ChangeState
trigger1 = numhelper(305)
trigger1 = helper(305), var(0) && anim != 630
value = 50

[State 650, AngleAdd]
type = AngleAdd
trigger1 = 1;time % 4 = 0
value = ifelse(vel X >= 0, -90, 90)

[State 650, Turn]
type = Turn
trigger1 = command = "back" && !var(59)
trigger2 = var(59) && ((P2Dist X < -30 && time < 240) || (P2Dist X > 30 && time > 240))

[State 650, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "facing %d vel x = %f"
params = facing, vel X
ignorehitpause = 1

[State 650, AngleDraw]
type = AngleDraw
trigger1 = 1

[State 650, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nostandguard
flag2 = nocrouchguard
flag3 = noairguard

[State 650, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noautoturn

;[State 650, AfterImage]
;type = AfterImage
;trigger1 = Time = 1 && prevstateno != 650 && power > 0
;time = 2
;length = 20
;paladd = 0,64,0
;palbright = 30,30,30
;palcontrast = 120,120,220
;trans = add
;ignorehitpause = 1

[State 650, Explod]
type = Explod
trigger1 = prevstateno != 650 && power > 0
anim = 651
ID = 650
pos = 0,0
facing = Facing
postype = p1
bindtime = -1
removetime = -1
scale = Const(size.xscale), Const(size.yscale)
sprpriority = 3
shadow = 0,0,0
ownpal = 1
removeongethit = 0
ignorehitpause = 1
persistent = 0

;[State 650, AfterImageTime]
;type = AfterImageTime
;trigger1 = power > 0
;time = 1
;ignorehitpause = 1

[State 650, NotHitBy]
type = NotHitBy
trigger1 = power > 0
value = ,AP
value2 =
value3
time = 1
ignorehitpause = 1

[State 650, PalFx]
type = PalFX
trigger1 = power > 0
time = 1
add = 0,ifelse(Time % 3 = 0, 256, 64),0
mul = 256,256,256
color = 256
ignorehitpause = 1

[State 650, PlayerPush]
type = PlayerPush
trigger1 = power > 0
value = 0
ignorehitpause = 1

[State 650, Subir]
type = VelSet
trigger1 = prevstateno != 60 && !var(59) && vel y > 0.2 && command = "Screw Attack"
trigger2 = time = 0
y = Const(velocity.jump.y)

[State 650, Rotina IA Pulo]
type = VelSet
triggerall = prevstateno != 60 && var(59) && Alive && roundstate = 2 && vel y > 0.2 && power > 0 && Enemynear, Pos Y + Enemynear, Const(size.height)  < Pos Y - Const(size.height)

trigger1 = (enemynear, Pos X - Pos X) < 90
trigger2 = random <= 950 && (enemynear, Pos X - Pos X) > 90
y = Const(velocity.jump.y)

[State 650, Rotina IA]
type = ChangeState
triggerall = var(59) && Alive && roundstate = 2 && time % 20 = 0 && random < 100
trigger1 = P2BodyDist X < 50 && P2BodyDist Y > 0;(Abs(enemynear, Pos X - Pos X) < 50 && enemynear, pos Y > Pos Y)
value = 660

[State 650, Rotina IA Movimentação]
type = VelSet
trigger1 = roundstate = 2 && var(59) && alive && prevstateno != 60
x = ifelse(time < 240, ifelse(P2Dist X < 60, 3, 0), ifelse(P2Dist X < -60, 0, 3))

[State 650, Evitar Subir Muito Alto]
type = VelSet
trigger1 = ScreenPos Y < 0 && vel Y < 0
y = 0

[State 650, Movimentação]
type = VelSet
triggerall = roundstate = 2 && !var(59) && prevstateno != 60
trigger1 = command = "holdfwd"
x = 3

[State 650, Movimentação]
type = VelSet
triggerall = roundstate = 2 && !var(59) && prevstateno != 60
trigger1 = command = "holdback"
x = -1

[State 650, PowerAdd]
type = PowerAdd
trigger1 = power > 0
value = -1
ignorehitpause = 1

[State 650, HitDef]
type = HitDef
trigger1 = power > 0 && time % 10 = 0
attr = A, NA
Hitflag = MAFD
guardflag = MA
animtype  = Hard
guard.pausetime = 10, 10
;pausetime = 2, 15
damage    = 20,0
getpower  = -10
priority  = 7
sparkxy = 0,0
sparkno = -1
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 0
ground.velocity = -6
air.velocity = -3,-2.8
air.fall = 1
palfx.time = 25
palfx.add = 255, 0, 0
fall.animtype = Hard
fall.recover = 0
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
fall = 1
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 15             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15
yaccel = .5

;-------------------------------------------------------
; Iron Ball
[StateDef 660]
ctrl = 0
type = A
movetype = A
physics = A
poweradd = 20
juggle = 5

[State 660, ChangeAnim]
type = ChangeAnim
trigger1 = !sysvar(2) && anim != 160 && time = 0
value = 160

[State 660, Width]
type = Width
trigger1 = 1
edge = 0,0
player = 0,0
value = 0,0

[State 660, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 660, AfterImage]
type = AfterImage
trigger1 = anim = 166 && vel Y > 0
time = 2
length = 20
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 50,0,0
paladd = 60,10,10
palmul = .65,.65,.75
;timegap = 1
framegap = 3
;trans = "add" ;"none","add1","sub"
ignorehitpause = 1
persistent = 0


[State 660, AfterImageTime]
type = AfterImageTime
trigger1 = anim = 166 && vel Y > 0
time = 2
ignorehitpause = 1

[State 660, HitDef]
type = HitDef
trigger1 = Vel Y > 0 && anim = 166
attr = A, NA
Hitflag = MAFD
guardflag = M
animtype = hard
damage = 40, 5
guardsound = 0
pausetime = 10,10
sparkno = 0
sparkxy = 0,0
Hitsound = 5,3
ground.type = High
air.type = High
ground.slidetime = 15
ground.hittime = 2
guard.velocity = -1.8
ground.velocity = -4,-3
air.velocity = -4,-3
air.fall = 1
fall = 1
fall.recover = 1
palfx.time = 50
palfx.add = 128, 128, 0
persistent = 0

[State 3160, PalFX]
type = PalFX
trigger1 = vel y > 0 && anim = 166
time = 1
add = 256,0,0
mul = 256,256,256
color = 256
ignorehitpause = 1

;[State 3160, AfterImageTime]
;type = AfterImageTime
;trigger1 = 1
;time = 2

[State 660, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 160 && animtime = 0 && !sysvar(2)
trigger2 = sysvar(2) && anim != 166
value = 166

[State 660, Gravity]
type = Gravity
trigger1 = anim = 166

[State 660, VelSet]
type = VelSet
trigger1 = Pos Y >= 0
y = 0

[State 660, EnvShake]
type = EnvShake
trigger1 = Pos Y >= 0
time = 30
freq = 60
ampl = -4
persistent = 0

[State 660, ChangeAnim]
type = ChangeAnim
trigger1 = Pos Y >= 0 && anim = 166 && !sysvar(2)
value = 162

[State 660, RestoreState]
type = ChangeState
trigger1 = Pos Y >= 0 && anim = 162 && animtime = 0
value = 52
ctrl = 1


[Statedef 999] ;Hyper Enfeite
type = U
movetype = U
velset = 0,0
ctrl = 0
poweradd = var(51)

[State 999, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

; Paralisar Animação
[State 999, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = anim
elem = animelemno(0)

; Tocar som do hyper
[State 999, PlaySnd]
type = PlaySnd
trigger1 = Time = 0
value = F20,0
ignorehitpause = 1

; Não poder levar dano enquanto o hyper estiver rolando
[State 999, 1]
type = NotHitBy
trigger1 = 1
value = SCA

; Hyper Spark
[State 999, 2]
type= Explod
trigger1 = time = 0
anim = f100
pos = floor(0*Const(size.xscale)),floor(-20* Const(size.yscale))
pausemovetime = -1
ownpal = 1
sprpriority = 5

; Samus Grandona
[State 999, 3]
type = Explod
trigger1 = time > 1
anim = 999
pos = (320-(320/time))-200,50
removetime = 1
postype = back
pausemovetime = 1
ownpal = 1
sprpriority = 5

; Efeito no BG
[State 999, 4]
type = BGPalFX
trigger1 = 1
add = 4*(64-time),4*(64-time),4*(64-time)
mul = 4*(64-time),4*(64-time),4*(64-time)
time = 1

; Pausar nesse momento
[State 999, 5]
type = Pause
trigger1 = time = 0
movetime = 60
time = 60

; Mudar para o estado anterior
[State 999, 6]
type = ChangeState
trigger1 = time > 60
value = prevstateno

; Congelado
[Statedef 1000]
type = U
movetype = H
physics = N

[State 1000, VelMul]
type = VelMul
trigger1 = 1
x = 0.95
y = 0.95

[State 1000, PlaySnd]
type = PlaySnd
trigger1 = !time
value = S1000,0
channel = 0

[State 1000, PalFX]
type = PalFX
trigger1 = time <= 5 && time % 2 = 0
time = 1
add = 256,256,256

[State 1000, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 1000, StateTypeSet]
type = StateTypeSet
trigger1 = Pos Y <= 0
statetype = A       ;S,A,C,L
movetype = H        ;I,A,H
physics = N         ;A,C,S,N

[State 1000, DefenceMulSet]
type = DefenceMulSet
trigger1 = 1
value = 1.5
ignorehitpause = 1

;[State 1000, Pegar Anim]
;type = Varset
;trigger1 = time = 0
;V = 29
;Value = Anim

;[State 1000, Pegar Elemento]
;type = VarSet
;trigger1 = time = 0
;V = 30
;Value = AnimElemNo(1)

[State 1000, VelSet]
type = PosSet
trigger1 = Pos Y > 0
y = 0

[State 1000, Congelar animação]
type = Changeanim
trigger1 = 1;time != 0
value = anim;Var(29)
elem = animelemno(0);Var(30)

[State 1000, Cor]
type = PalFX
trigger1 = (time > 5 || (time <= 5 && time % 2)) && time < 200
trigger2 = time >= 200 && (time % 2) = 0
add = 0, 128, 255
mul = 255, 255, 255
time = 1

[State 106, 3]
type = MakeDust
trigger1 = pos y >= 0 && time % 2 = 0 && abs(vel x) >= 1
pos = 0,0
spacing = 1

[State 1000, Descongelar]
type = SelfState
trigger1 = time >= 325 || GetHitVar(fall.yvel) - gametime > 30
value = ifelse(IsHelper, prevstateno, ifelse(!Alive, 5000, ifelse(Pos Y >= 0, 0, 50)))
ctrl = 1

;---------------------------------------------------------------------------
; Toggle Morphing Ball Mode
[Statedef 1200]
type = S
movetype = I
ctrl = 0
velset = 0,0
anim = 162

[State 1200, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

[State 1200, 1]
type = VarSet
trigger1 = anim = 162 && animtime = 0
sysvar(2) = 0

[State 1200, 2]
type = ChangeState
trigger1 = anim = 162 && animtime = 0
value = 11
ctrl = 1

[Statedef 1201]
type = S
movetype = I
ctrl = 0
velset = 0,0
anim = 160

[State 1201, 1]
type = VarSet
trigger1 = 1
sysvar(2) = 1

[State 1201, 2]
type = ChangeState
trigger1 = anim = 160 && animtime = 0
value = 0
ctrl = 1

[Statedef 1999]
type = S
movetype = I
velset = 0,0
anim = 2000

[State 1999, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

;life
[State 1999, 1]
type = LifeSet
trigger1 = time <= 0
value = 250

[State 1999, 2]
type = ChangeState
trigger1 = time > 0
value = ifelse(Pos Y >= 0, 2000, 2001)

; Side Hopper (Parado)
[Statedef 2000]
type = S
movetype = A
physics = S
velset = 0,0
anim = 2000

[State 2000, PosSet]
type = PosSet
trigger1 = Pos Y < 0
y = 0

[State 2000, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Vida: %d"
params = life

[State 2000, HitDef]
type = HitDef
trigger1 = 1
attr = S,NA        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
getpower = 0,0
givepower = 1,0
animtype = light          ;light,medium,hard,back,up,diagup
air.animtype = light
priority = 4,Miss   ;Hit,Miss,Dodge
damage = 5,2
sparkno = -1
ground.velocity = -2,-4.5
ground.type = High      ;Low,Trip,None
ground.slide = 0
ground.hit = 0
air.velocity = -2,-4.5
fall = 0
fall.yvelocity = -4.5
fall.recover = 1
fall.recovertime = 4
fall.damage = 0
kill = 0
guard.kill = 1
fall.kill = 1
numhits = 1
palfx.time = 5
palfx.mul = 256,256,256
palfx.add = 256,256,256
persistent = 0

[State 2000, VelSet]
type = VelSet
trigger1 = 1
x = 0
y = 0

[State 2000, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
slot = 0
time = 1
stateno = 2002

; Dead
[State 2000, Dead]
type = ChangeState
trigger1 = life <= 0
value = 2003

[State 2000, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 2000 && roundstate = 2;time > 60 && anim = 2000 && roundstate = 2
value = 2001

[State 2000, Pular]
type = ChangeState
trigger1 = anim = 2001 && animtime = 0
value = 2001

; Side Hopper (Pulando)
[Statedef 2001]
type = S
movetype = A
physics = S
anim = 2002

[State 2001, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Vida: %d Facing = %d"
params = var(10), Facing

[State 2001, HitDef]
type = HitDef
trigger1 = animelem = 1
attr = S,NA        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
getpower = 0,0
givepower = 1,0
animtype = light          ;light,medium,hard,back,up,diagup
air.animtype = light
priority = 4,Miss   ;Hit,Miss,Dodge
damage = 5,2
sparkno = -1
ground.velocity = -2,-4.5
ground.type = High      ;Low,Trip,None
ground.slide = 0
ground.hit = 0
air.velocity = -2,-4.5
fall = 0
fall.yvelocity = -4.5
fall.recover = 1
fall.recovertime = 4
fall.damage = 0
kill = 0
guard.kill = 1
fall.kill = 1
numhits = 1
palfx.time = 5
palfx.mul = 256,256,256
palfx.add = 256,256,256

[State 2001, Var(1)]
type = VarSet
trigger1 = 1
v = 34
value = ifelse(Pos X <= enemynear, Pos X, 1,0)
persistent = 0

[State 2001, VelSet]
type = PosAdd
triggerall = prevstateno != 2002
trigger1 = BackEdgeBodyDist <= 0
x = 2

[State 2001, VelSet]
type = PosAdd
triggerall = prevstateno != 2002
trigger1 = FrontEdgeBodyDist <= 0
x = -2

[State 2001, VelSet]
type = PosAdd
triggerall = prevstateno != 2002 && BackEdgeBodyDist > 0 && FrontEdgeBodyDist > 0
trigger1 = var(34)
x = 2

[State 2001, VelSet]
type = PosAdd
triggerall = prevstateno != 2002 && BackEdgeBodyDist > 0 && FrontEdgeBodyDist > 0
trigger1 = !var(34)
x = -2

[State 2001, Turn]
type = Turn
trigger1 = Facing != 1

[State 2001, PosSet]
type = PosSet
trigger1 = 1
value = 1
persistent = 1

[State 2001, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
slot = 0
time = 1
stateno = 2002

[State 2001, Pular]
type = VelSet
trigger1 = Pos Y >= 0 && time <= 1
y = -6
persistent = 0

[State 2001, Pular]
type = VelAdd
trigger1 = Pos Y < 0
y = .48

[State 2001, Pular]
type = VelAdd
trigger1 = Pos Y > 0
y = -.48

[State 2001, Pular]
type = VelSet
trigger1 = Pos Y = 0
y = 0

; Dead
[State 2001, Dead]
type = ChangeState
trigger1 = !life
value = 2003

[State 2001, RestoreState]
type = ChangeState
trigger1 = Pos Y >= 0 && time > 1
value = 2000

; Side Hopper Hit
[Statedef 2002]
type = S
movetype = H
physics = S
velset = 0,0

[State 2002, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Vida: %d"
params = life;var(10)

[State 2002, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = ifelse(Pos Y < 0,2002,2000)

;Generated by Fighter Factory PalFX Editor
[State 2002, PalFXWiz]
type = PalFX
trigger1 = gametime % 2 = 0
time = 1
add = 256,256,256
mul = 256,256,256
color = 256
persistent = 0

;[State 2002, VarAdd]
;type = VarAdd
;trigger1 = 1
;v = 10
;value = -1
;persistent = 0

; Dead
[State 2002, Dead]
type = ChangeState
trigger1 = !life;var(10) <= 0
value = 2003

[State 2002, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
slot = 0
time = 1
stateno = 2002

[State 2002, RestoreState]
type = ChangeState
trigger1 = time >= 15
value = ifelse(pos y >= 0, 2000, 2001)

[Statedef 2003]
type = S
movetype = H
physics = S
velset = 0,0

[State 2003, Explod]
type = Explod
trigger1 = 1
anim = 4101
ID = 10
pos = 0,-30
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
random = 50,30
removetime = 30
scale = 1,1
sprpriority = 0
ontop = 1
ownpal = 1
removeongethit = 0
persistent = 6

[State 2003, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Vida: %d"
params = var(10)

[State 2003, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

[State 2003, Destroy]
type = DestroySelf
trigger1 = time >= 120

;---------------------------------------------------------------------------
; Shinespark
[Statedef 3000]
type    = S
movetype= A
physics = N;S
;juggle  = 4
velset = 0,0
anim = 41
ctrl = 0
sprpriority = 2
;juggle = 15

[State 3000, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1
ignorehitpause = 1

[State 3000, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3000, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

;[State 3000, Width]
;type = Width
;trigger1 = 1
;edge = 0,0
;player = 0,0
;value = 0,0

[State 3000, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && anim = 41 && animtime = 0
value = 999

[State 3000, ChangeAnim]
type = ChangeAnim
trigger1 = prevstateno = 999 && anim = 41
value = 3000

[State 3000, 2]
type = VelSet
trigger1 = FrontEdgeBodyDist > 0 && anim = 3000
x = 15



;[State 3000, SuperPause]
;type = SuperPause
;trigger1 = FrontEdgeBodyDist <= 0
;time = 50
;anim = 0
;sound = S5000, 0
;pos = 0, 0
;move = 1
;darken = 1
;p2defmul = 0
;poweradd = 0
;unhittable = 1
;endcmdbuftime = (winmugen only)
;pausebg =  (winmugen only)
;ignorehitpause =
;persistent = 0

[State 3000, 3]
type = AfterImage
trigger1 = AnimElem = 1
time = 25
length = 15
PalBright   =128,128,64

[State 3000, 3]
type = AfterImageTime
trigger1 = 1
time = 15

[State 3000, PalFx]
type = PalFX
trigger1 = time%5 = 0 && anim = 3000
time = 5
add = 128,128,64
mul = 256,256,15
sinadd = 256,256,256,5
color = 256

[State 3000, 3]
type = LifeAdd
trigger1 = anim = 3000 && life > 1 && time % 2 = 0
value = -1

[State 3000, VarSet]
type = VarSet
trigger1 = 1
v = 7
value =  ceil(Enemynear, Pos Y - Pos Y)

[State 3000, VarSet]
type = VarSet
trigger1 = var(7) < -5
v = 7
value = -5

[State 3000, VarSet]
type = VarSet
trigger1 = var(7) > 5
v = 7
value = 5

[State 3000, VelAdd]
type = VelSet
trigger1 = 1
;x = 15;ifelse(anim = 3000, Vel X, 0)
y = ifelse(ScreenPos Y <= 0, 0, ifelse(anim = 3000, var(7), 0))


[State 3000, HitDef]
type = HitDef
trigger1 = HitCount < 20
attr = S, HA
hitflag = HLAFD
animtype  = Hard
damage    = 25,1
getpower  = 0
priority  = 6
guardflag = MA
sparkxy = 21,-17
sparkno = 3
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -vel x,-6
air.velocity = -vel x,-6
air.fall = 1
palfx.time = 25
palfx.add = 255, 0, 0
fall.animtype = Hard
fall.recover = 0
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
p2facing = 1                 ;Force p2 to face p1 on hit
fall = 0
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 70             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15
airguard.velocity = 0,0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0

;[State 3000, NotHitBy]
;type = NotHitBy
;trigger1 = 1
;value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;time = 1

[State 3000, ChangeAnim]
type = ChangeAnim
triggerall = anim != 3001
trigger1 = FrontEdgeBodyDist <= 0 || life <= 1 || time > 300; || MoveGuarded
value = 3001

[State 3000, RestoreState]
type = ChangeState
trigger1 = anim = 3001 && animtime = 0
value = ifelse(Pos Y >= 0, 0, 50)
ctrl = 1

;---------------------------------
; Speed Booster Up
[Statedef 3025]
type    = S
movetype= A
physics = N
juggle  = 4
velset = 0,0
anim = 3029
ctrl = 0

[State 3025, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3025, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3025, 1]
type = PlaySnd
trigger1 = AnimElem = 4
trigger2 = AnimElem = 12
trigger3 = AnimElem = 20
value = 0, 3

[State 3025, 2]
type = VelAdd
trigger1 = ScreenPos Y >= 0
y = -2

[State 3025, 2]
type = VelSet
trigger1 = ScreenPos Y < 0 && vel Y < 0
y = 5

[State 3025, PosSet]
type = PosSet
trigger1 = ScreenPos Y < 0
y = -300

[State 3025, 3]
type = AfterImage
trigger1 = AnimElem = 1
time = 25
length = 15
PalBright   =128,128,64

[State 3025, 3]
type = PalFX
trigger1 = time%5 = 0
time = 5
add = 128,128,64
mul = 256,256,15
sinadd = 256,256,256,5
color = 256

[State 3025, 3]
type = AfterImageTime
trigger1 = 1
time = 15

[State 3025, 3]
type = LifeAdd
trigger1 = stateno = 3025
value = -1

[State 3025, 4]
type = HitDef
trigger1 = stateno = 3025
attr = S, HA
animtype  = Hard
damage    = 5,1
getpower  = 0
priority  = 6
guardflag = MA
;pausetime = 15,15
sparkxy = -10,-60
sparkno = 3
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = 0,-15
air.velocity = 0,-15
air.fall = 1
palfx.time = 25
palfx.add = 255, 0, 0
fall.animtype = Hard
fall.recover = 0
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
p2facing = 1                 ;Force p2 to face p1 on hit
fall = 1
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 70             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15
yaccel = .8                  ;Accelerate p2 downwards rapidly

[State 3025, 6]
type = ChangeState
trigger1 = ScreenPos Y < 35
value = 50
ctrl = 1

;---------------------------------------------------------------------------
; Shot Power Bomb
[Statedef 3050]
type    = S
movetype= A
physics = S
juggle  = 4
velset = 0,0
ctrl = 0

[State 3050, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

[State 3050, ChangeAnim]
type = ChangeAnim
trigger1 = !sysvar(2) && anim != 3050 && time > 1
value = 3050

[State 3050, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3050, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3050, 2]
type = Helper
helpertype = normal
triggerall = prevstateno = 999
trigger1 = AnimElem = 3 && !sysvar(2)
trigger2 = sysvar(2)
id = 250
name = "Power Bomb"
postype = player
pos = 0, 0
stateno = 3051
keyctrl = 0
ownpal = 1
sprpriority = 10
persistent = 0

[State 3050, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

; Power Bomb
[Statedef 3051]
type = S
movetype = A
velset = 0,0
anim = 3020
sprpriority = 5

;[State 3051, EnvColor]
;type = EnvColor
;trigger1 = AnimElemNo(1) = 13 && IsHelper(250)
;value = time*26,time*26,0
;time = 1

;[State 3051, Trans]
;type = Trans
;trigger1 = var(11) < 256
;trans = addalpha
;alpha = (256 - var(11)), 256

;[State 3051, Var 11]
;type = VarAdd
;trigger1 = animelemno(1) >= 12
;trigger1 = var(11) < 256
;v = 11
;value = 2

[State 3051, 1]
type = PlaySnd
trigger1 = AnimElem = 14
value = 3020,0

[State 3051, DisplayToClipboard]
type = DisplayToClipboard
trigger1 =  1
text = "animelem = %d var(10) = %d var(26) = %d"
params = animelemno(0), var(10), var(26)
ignorehitpause = 1

[State 3051, VarSet]
type = VarSet
trigger1 = animelemno(0) >= 14
v = 10    ;fv = 10
value = time
ignorehitpause = 1
persistent = 0

[State 3051, VarSet]
type = VarSet
trigger1 = animelemno(0) >= 14;animelemno(0) >= 13;time > 130
fv = 26
value = ((time-var(10))/36.0)

[State 3051, ChangeAnim]
type = ChangeAnim
trigger1 = GetHitVar(damage) > 0 && animelemno(0) <= 13
value = anim
elem = 14
ignorehitpause = 1

[State 3051, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
stateno = 3051
time = 1
ignorehitpause = 1

[State 3051, Explod]
type = Explod
trigger1 = AnimElem = 14
anim = 3021
ID = 3020
pos = 0,0
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale)*fvar(26), Const(size.yscale)*fvar(26)
ontop = 1
ownpal = 1
alpha = 256-floor(fvar(26)*256.0), 256
ignorehitpause = 1

[State 3051, ModifyExplod]
type = ModifyExplod
trigger1 = fvar(26) <= 1
ID = 3020
scale = Const(size.xscale)*fvar(26), Const(size.yscale)*fvar(26)/2
ontop = 1
ownpal = 1
trans = addalpha
alpha = 256-floor(fvar(26)*256.0), 256;, 256-floor(fvar(26)*256.0)
ignorehitpause = 1

[State 3051, RemoveExplod]
type = RemoveExplod
trigger1 = animtime = 0;fvar(26) > 1.0
id = 3020
ignorehitpause = 1

[State 3051, 1]
type = EnvShake
trigger1 = AnimElem = 14
value = 3020,0
time = 50
freq = 60
ampl = -4
phase = 90

[State 3051, 2]
type = HitDef
trigger1 = AnimElem = 14
trigger2 = AnimElem = 15
trigger3 = AnimElem = 16
trigger4 = AnimElem = 17
trigger5 = AnimElem = 18
trigger6 = AnimElem = 19
trigger7 = AnimElem = 20
trigger8 = AnimElem = 21
trigger9 = AnimElem = 22
trigger10 = AnimElem = 23
attr = A, NA
Hitflag = MAFD
animtype = hard
damage = ifelse(IsHelper(250), 22, 5), ifelse(IsHelper(250), 10, 1)
guardflag = M
guardsound = 0
pausetime = 0,0
sparkno = 0
sparkxy = 0,0
Hitsound = 5,3
ground.type = Low
ground.slidetime = 15
ground.hittime = 2
guard.velocity = -1.8
ground.velocity = -4,-3
air.velocity = -4,-3
fall = 1
fall.recover = 1
palfx.time = 50
palfx.add = 128, 128, 0

[State 3051, 3]
type = SprPriority
trigger1 = stateno = 3051
value = 10

[State 3051, 4]
type = DestroySelf
trigger1 = animtime = 0;fvar(26) > 1.0

; Recharge
[Statedef 3100]
type = S
movetype = I
velset = 0,0
juggle = 1
ctrl = 0

[State 3100, 1]
type = ChangeAnim
trigger1 = !sysvar(2) && anim != 160 && time < 2
value = 160

[State 3100, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -Power

[State 3100, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3100, 3]
type = ChangeAnim
trigger1 = anim = 160 && animtime = 0 && !sysvar(2)
value = 161

[State 3100, 4]
type = VelSet
triggerall = numhelper(3100) <= 0
trigger1 = anim = 161
y = -7
persistent = 0

[State 3100, 5]
type = VelSet
triggerall = numhelper(3100) <= 0
trigger1 = anim = 161
x = -3

[State 3100, 6]
type = VelSet
trigger1 =  numhelper(3100) > 0 && life < LifeMax
x = 0
y = 0

[State 3100, 7]
type = Helper
triggerall = numhelper(3100) <= 0
trigger1 = Pos Y < -200
helpertype = normal ;player
name = "Chozo"
ID = 3100
stateno = 3101
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0

[State 3100, 8]
type = LifeAdd
triggerall = numhelper(3100) > 0
trigger1 = Life < LifeMax && helper(3100),Pos Y >= 0
value = 1

[State 3100, 9]
type = PalFX
triggerall = numhelper(3100) > 0
trigger1 = Time % 25 = 0 && helper(3100),Pos Y >= 0 && Life < LifeMax
time = 25
add = 0,128,0
mul = 256,256,256
sinadd = 0,128,256,25
invertall = 0
color = 256

[State 3100, 10]
type = PlayerPush
trigger1 = 1
value = 0

[State 3100, 11]
type = PosSet
triggerall = numhelper(3100) > 0
trigger1 = life < lifeMax
x = helper(3100), pos x + ((15 * Facing))*Const(size.xscale)
y = helper(3100), pos y - (31) * Const(size.yscale)

[State 3100, 12]
type = VelAdd
trigger1 = Pos Y < 0 && life >= LifeMax
y = .45

[State 3100, 13]
type = VelSet
trigger1 = Pos Y >= 0 && life >= LifeMax
y = 0

[State 3100, 14]
type = NotHitBy
trigger1 = 1
value = SCA

[State 3100, 15]
type = ChangeAnim
trigger1 = anim = 161 &&  Pos Y >= 0 && life >= lifeMax && !sysvar(2)
value = 162

[State 3100, 16]
type = ChangeState
trigger1 = anim = 162 && animtime = 0 && !sysvar(2)
trigger2 = sysvar(2)
value = 0
ctrl = 1

; Chozo
[Statedef 3101]
type = S
movetype = A
velset = 0,0
anim = 3100
juggle = 1

[State 3101, SprPriority]
type = SprPriority
trigger1 = 1
value = 5

[State 3101, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 3101, HitDef]
type = HitDef
trigger1 = Vel Y > 0
attr = A, NA
animtype = hard
damage = 44, 22
guardflag = M
guardsound = 0
Hitflag = MAFD
pausetime = 8,5
sparkno = 0
sparkxy = 0,0
Hitsound = 5,3
ground.type = Low
ground.slidetime = 15
ground.hittime = 2
guard.velocity = -1.8
ground.velocity = -4,-3
air.velocity = -4,-3
fall = 1
fall.recover = 1
palfx.time = 50
palfx.add = 128, 128, 0

[State 3101, Veladd]
type = VelAdd
trigger1 = Pos Y < 0
y = .40

[State 3101, VelSet]
type = VelSet
trigger1 = Pos Y >= 0
y = 0

[State 0, EnvShake]
type = EnvShake
trigger1 = Pos Y >= 0
time = 30
freq = 60
ampl = -4
persistent = 0

[State 3101, Trans]
type = Trans
trigger1 = var(1) < 256 && root, Life >= root, LifeMax
trigger2 = root, stateno != 3100
trans = addalpha
alpha = (256 - var(1)), 256

[State 3101, Var(1)]
type = VarAdd
trigger1 = var(1) < 256 && root, Life >= root, LifeMax
trigger2 = root, stateno != 3100
v = 1
value = 1

[State 3101, DestroySelf]
type = DestroySelf
trigger1 = var(1) >= 256

;Grappling (Procurar pelo oponente)
[Statedef 3150]
type    = S
movetype= A
physics = S
juggle  = 4
velset = 0,0
anim = 3150
ctrl = 0

[State 3150, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3150, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3150, PosAdd]
type = PosAdd
trigger1 = FrontEdgeBodyDist > 0
x = 15

[State 3150, AfterImage]
type = AfterImage
trigger1 = AnimElem = 1
time = 25
length = 30
PalBright   = 0,0,255

[State 3150, PalFx]
type = PalFX
trigger1 = 1
time = 1
add = 0, 0, 200

[State 3150, AfterImageTime]
type = AfterImageTime
trigger1 = 1
time = 15

[State 3150, HiDef]
type = HitDef
Trigger1 = Time = 0
attr = S, NT
hitflag = M
priority = 1, Miss
sparkno = -1
sprpriority = 1
p2facing = 1
p1stateno = 3151

[State 3150, ChangeState]
type = ChangeState
trigger1 = FrontEdgeBodyDist <= 0
value = ifelse((Statetype = S),0,ifelse((Statetype = A),50,0))
ctrl = 1

; Procura feita com sucesso
[Statedef 3151]
type    = S
movetype= A
physics = S
juggle  = 4
velset = 0,0
anim = 3151
ctrl = 0

[State 3151, AfterImage]
type = AfterImage
trigger1 = AnimElem = 1
time = 25
length = 30
PalBright   = 0,0,255

[State 3151, PalFx]
type = PalFX
trigger1 = 1
time = 1
add = 0, 0, 200

[State 3151, AfterImageTime]
type = AfterImageTime
trigger1 = 1
time = 15

[State 3151, Posset]
type = Posset
trigger1 = 1
x = Enemynear, Pos X

[State 3151, HiDef]
type = HitDef
trigger1 = stateno = 3151
attr = S, HA
animtype  = Hard
damage    = 5,1
getpower  = 0
priority  = 6
sparkno = -1
guardflag = MA
pausetime = 0,0
ground.type = Low
palfx.time = 1
palfx.add = 255, 0, 0
p2facing = 1                 ;Force p2 to face p1 on hit
p2stateno = 3152

[State 3151, PlaySnd]
type = PlaySnd
trigger1 = AnimTime = 0
value = S5,4

[State 3151, VelSet]
type = VelSet
trigger1 = AnimTime = 0
y = -6
x = 5

[State 3151, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 50
p2stateno = 3153
ctrl = 1

; Inimigo ficará imóvel enquanto é agarrado
[Statedef 3152]
type = A
movetype = H
physics = N
velset = 0,0
anim = 5000

[State 3152, VelSet]
type= VelSet
trigger1 = 1
x = 0
y = 0

[State 3152, 1]
type= CtrlSet
trigger1 = 1
value = 0

[State 3152, 2]
type = ChangeState
trigger1 = p2stateno != 3151
trigger1 = stateno = 3152
value = 5050

;Recuperar controle do inimigo depois de agarrar
[Statedef 3153]
type = A
movetype = U
physics = U
velset = 0,0
anim = 5000

[State 3153, 1]
type= CtrlSet
trigger1 = stateno = 3153
trigger1 = !ctrl
value = 1

[State 3153, 2]
type = ChangeState
trigger1 = ctrl
value = 5000

; Morphing Ball Attack
[Statedef 3160]
type = S
movetype = A
physics = S
velset = 0,0
anim = 165
ctrl = 0

[State 3160, varset]
type = VarRangeSet
trigger1 = time = 0
value =  15
first = 20
last = 21

[State 3160, AfterImage]
type = AfterImage
trigger1 = AnimElem = 1
time = 2
TimeGap = 1
FrameGap = 1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,120
palpostbright = 0,0,0
paladd =250,10,250
palmul = .75,.65,.65

[State 3160, PalFX]
type = PalFX
trigger1 = 1
time = 1
add = 256,0,0
mul = 256,256,256
color = 256

[State 3160, AfterImageTime]
type = AfterImageTime
trigger1 = 1
time = 2

[State 3160, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3160, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3160, 4]
type = HitDef
trigger1 = 1
attr = S, HA
hitflag = HLAFD
animtype  = Hard
damage    = 20,3
getpower  = 1
givepower = 50
priority  = 6
guardflag = MA
;pausetime = 15,15
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = vel x*2, -Abs(vel y)/2
air.velocity = vel x*2, -Abs(vel y)/2
air.fall = 1
palfx.time = 25
palfx.add = 255, 0, 0
fall.animtype = Hard
fall.recover = 0
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
p2facing = Facing
fall = 1
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 70             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15
fall.yvelocity = -0.5

[State 3160, VelSet]
type = VelSet
trigger1 = 1
x = var(20)
y = var(21)

[State 3160, VarSet]
type = VarSet
trigger1 = BackEdgeBodyDist <= 0
v = 20
value = abs(var(20))

[State 3160, VarSet]
type = VarSet
trigger1 = BackEdgeBodyDist <= 0
v = 20
value = abs(var(20))

[State 3160, EnvShake]
type = EnvShake
trigger1 = BackEdgeBodyDist <= 0
trigger2 = FrontEdgeBodyDist <= 0
trigger3 = ScreenPos Y < 0
trigger4 = Pos Y >= 0
time = 1
freq = 60
ampl = -4
phase = 90

[State 3160, VarSet]
type = VarSet
trigger1 = FrontEdgeBodyDist <= 0
v = 20
value = -abs(var(20))

[State 3160, VarSet]
type = VarSet
trigger1 = ScreenPos Y < 0
v = 21
value = abs(var(21))

[State 3160, VarSet]
type = VarSet
trigger1 = Pos Y >= 0
v = 21
value = -abs(var(21))

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0

[State 3160, ChangeAnim]
type = ChangeAnim
trigger1 = time >= 500 && anim != 162 && !sysvar(2)
value = 162

[State 3160, RestoreState]
type = ChangeState
triggerall = time >= 500
trigger1 = anim = 162 && animtime = 0 && !sysvar(2)
trigger2 = sysvar(2)
value = ifelse(Pos Y >= 0, 0, 50)
ctrl = 1

; Rocket Attack
[Statedef 3200]
type = S
movetype = A
physics = S
velset = 0,0
anim = 3200
ctrl = 0

[State 3160, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3200, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3200, VelSet]
type = VelSet
trigger1 = animelem = 2
x = -14
persistent = 0

[State 3200, Helper]
type = Helper
trigger1 = animelem = 2
helpertype = normal ;player
name = "Super Rocket"
ID = 3200
stateno = 3201
pos = ceil(14*Const(size.xscale)),ceil(-45*Const(size.xscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0

[State 3200, Helper]
type = Helper
trigger1 = animelem = 3
helpertype = normal ;player
name = "Super Rocket"
ID = 3200
stateno = 3201
pos = ceil(14*Const(size.xscale)),ceil(-45*Const(size.xscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
persistent = 0

[State 3200, PalFX]
type = PalFX
trigger1 = animelemno(1) < 2 && anim = 3200
time = 1
add = time*4,time*2,time
mul = 256,256,256
invertall = 0
color = 256

[State 3200, PalFX]
type = PalFX
trigger1 = animelemno(1) = 2 && anim = 3200
time = 1
add = 256,256,256
mul = 256,256,256
invertall = 0
color = 256

[State 3200, RestoreState]
type = ChangeState
trigger1 = animtime = 0
value = 0
ctrl = 1

; Rocket
[Statedef 3201]
type = S
movetype = A
physics = S
velset = 5,-5
anim = 3201
sprpriority = -2

[State 3200, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 3200,0
volume = 0
channel = -1
freqmul = 1.0

;Generated by Fighter Factory PalFX Editor
[State 3201, PalFXWiz]
type = PalFX
trigger1 = !time
time = -1
add = 240,50,0
mul = 250,224,120
sinadd = 110,55,85,10
invertall = 0
color = 0
ignorehitpause = 1

[State 3201, AfterImage]
type = AfterImage
trigger1 = !time
time = -1
length = 20
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 10,10,25
palmul = .65,.65,.75
timegap = 1
framegap = 1
ignorehitpause = 1

[State 3201, VarSet]
type = VarSet
trigger1 = Time = 0 && root, var(42) >= 0
v = 10
value = ceil(enemynear(root, var(42)), pos x) + (random - random)%100

[State 3201, Turn]
type = Turn
trigger1 = Facing != 1 && var(0)

[State 3201, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "fvar(1) = %f var(0)= %d"
params = fvar(1), var(0)

[State 3201, AngleAdd]
type = VarSet
trigger1 = time = 0
fv = 1
value = 45

[State 3201, AngleAdd]
type = VarAdd
trigger1 = fvar(1) > 359
fv = 1
value = -359

[State 3201, AngleAdd]
type = VarAdd
trigger1 = fvar(1) < -359
fv = 1
value = 359

[State 3201, AngleAdd]
type = VarAdd
trigger1 = anim = 3201 && fvar(1) < 90 && !var(0)
fv = 1
value = 1.5

[State 3201, VarSet]
type = VarSet
trigger1 = Pos Y <= -500
v = 0
value = 1

[State 3201, VelAdd]
type = PosAdd
trigger1 = Pos X > var(10) && var(0)
x = -2

[State 3201, VelAdd]
type = PosAdd
trigger1 = Pos X < var(10) && var(0)
x = 2

[State 3201, AngleAdd]
type = VarAdd
trigger1 = anim = 3201 && fvar(1) < -90 && var(0)
fv = 1
value = 8.5

[State 3201, AngleAdd]
type = VarAdd
trigger1 = anim = 3201 && fvar(1) > -90 && var(0)
fv = 1
value = -8.5

[State 3201, Explod]
type = Explod
trigger1 = anim = 3201
anim = 4100
ID = 4100
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = -vel x/8,-vel y/8
accel = 0,0
random = 5,5
scale = Const(size.xscale),Const(size.yscale)
sprpriority = -1
ownpal = 1
removeongethit = 0

[State 3201, Explod]
type = Explod
trigger1 = anim != 3201
anim = ifelse(random < 500, 4101, 4105)
ID = 4101
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = -2+((random*5)/1000.0),-5+((random*11)/1000.0)
accel = 0,0
random = 0,0;90,90
scale = 1,1
sprpriority = 5
ownpal = 1
removeongethit = 0

[State 3201, Explod]
type = Explod
trigger1 = anim != 3201
anim = ifelse(random < 500, 4101, 4105)
ID = 4101
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = -2+((random*5)/1000.0),-5+((random*11)/1000.0)
accel = 0,0
random = 0,0;90,90
scale = Const(size.xscale),Const(size.yscale)
sprpriority = 5
ownpal = 1
removeongethit = 0

[State 3201, AngleAdd]
type = AngleSet
trigger1 = anim = 3201
value = ceil(fvar(1))

[State 3201, AngleDraw]
type = AngleDraw
trigger1 = anim = 3201

;[State 3201, Gravity]
;type = Gravity
;trigger1 = Pos Y < 0 && prevstateno != 3201

[State 3201, VelSet]
type = VelSet
trigger1 = !var(0) && Pos Y < 0  && prevstateno != 3201
x = 4.0*(Cos(fvar(1)*PI/180))
y = -4.0*(Sin(fvar(1)*Pi/180))

[State 3201, Gravity]
type = Gravity
trigger1 = var(0)

[State 3201, PlaySnd]
type = PlaySnd
trigger1 = anim = 4101
value   = F5,4
;value = 3201,0
persistent =  0

[State 3201, EnvShake]
type = EnvShake
trigger1 = Pos Y > 0
time = 20
freq = 60
ampl = -4
phase = 90
persistent = 0

[State 3201, VelSet]
type = VelSet
trigger1 = Pos Y > 0
trigger2 = anim = 4101
x = 0
y = 0

[State 3201, PosSet]
type = PosSet
trigger1 = prevstateno = 4101 && time = 0
y = floor(Pos Y + 15)

[State 3201, ChangeAnim]
type = ChangeAnim
trigger1 = Pos Y >= 0 && anim = 3201
trigger2 = prevstateno = 3201
value = 4101
persistent = 0

[State 3201, 4]
type = HitDef
trigger1 = anim = 3201
attr = S, HA
hitflag = HLAFD
animtype  = Hard
affectteam = E
priority  = 6
guardflag = MA
sparkno = -1
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
p1stateno = 3201
persistent = 0

[State 3201, HitDef]
type = HitDef
trigger1 = HitCount < 2 && anim != 3201
attr = S, HA
affectteam = B
hitflag = HLAFD
animtype  = Hard
damage    = 200,20
getpower  = 5
givepower = 15
priority  = 6
guardflag = M
sparkxy = 0,0
sparkno = 3
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -18,-18
air.velocity = -18,-18
air.fall = 1
palfx.time = 300
palfx.add = 240, 50, 0
palfx.mul = 250,224,120
palfx.sinadd = 110,55,85,10
fall.animtype = Hard
fall.recover = 0
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
fall = 1
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 70             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15
airguard.velocity = 0,0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
persistent = 0

[State 3201, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

;[State 3201, PosSet]
;type = Posset
;trigger1 = anim != 3201 && numtarget > 0
;x = enemynear, pos x
;y = enemynear, pos y

[State 3201, EnvShake]
type = EnvShake
trigger1 = anim != 3201
time = -animtime
freq = 60
ampl = -4
phase = 90
ignorehitpause = 1
persistent = 0

[State 3201, VarSet]
type = VarSet
trigger1 = var(0) && !var(1) && anim != 3201
v = 1
value = -animtime
ignorehitpause = 1

[State 3201, AllPalFX]
type = AllPalFX
trigger1 = var(0) && anim != 3201
time = 1
add = floor(256.0*(-(animtime*1.0)/(var(1)*1.0))),floor(256.0*(-(animtime*1.0)/(var(1)*1.0))),floor(256.0*(-(animtime*1.0)/(var(1)*1.0)))
;invertall = 0
;color = 256
;ignorehitpause =
;persistent =


[State 3201, DestroySelf]
type = DestroySelf
trigger1 = anim != 3201 && animtime = 0

;---------------------------------------------------------------------------
; Flamethrower
[Statedef 3300]
type    = S
movetype= A
physics = S
juggle  = 4
velset = 0,0
anim = 3300
ctrl = 0
sprpriority = 1

[State 3300, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
slot = 0
stateno = 3302
time = 1
forceair = 0

[State 3300, 1]
type = VelSet
trigger1 = command = "holdfwd"
x = const(velocity.walk.fwd.x)

[State 3300, 2]
type = VelSet
trigger1 = command = "holdback"
x = const(velocity.walk.back.x)

[State 3300, Turn]
type = Turn
trigger1 = Pos X > enemynear, Pos X && facing = 1
trigger2 = Pos X < enemynear, Pos X && facing = -1

[State 3300, Restaurar Anim]
type = ChangeAnim
trigger1 = !vel x
value = 3300

[State 3300, 3]
type = ChangeAnim
triggerall = vel x > 0
trigger1 = Anim != 3303
value = 3303

[State 3300, 4]
type = ChangeAnim
triggerall = vel x < 0
trigger1 = Anim != 3304
value = 3304

[State 3300, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3300, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1 && prevstateno != 3302
value = 999

[State 3300, 3]
type = PalFX
trigger1 = time%5 = 0 && anim = 3000
time = 5
add = 128,0,0
mul = 256,256,256
color = 256

[State 3300, Helper]
type = Helper
triggerall = numhelper(3300) <= 0
trigger1 = power > 0
helpertype = normal ;player
name = "Braço"
ID = 3300
stateno = 3301
pos = ceil(1*Const(size.xscale)),ceil(-36*Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 1
ownpal = 0
size.xscale = Const(size.xscale)
size.yscale = Const(size.yscale)

[State 3301, StateTypeSet]
type = StateTypeSet
triggerall = numhelper(3300) > 0
trigger1 = helper(3300), command = "holdx"
statetype = S
movetype = A

[State 3301, StateTypeSet]
type = StateTypeSet
triggerall = numhelper(3300) > 0
trigger1 = helper(3300), command != "holdx"
statetype = S
movetype = I

[State 3300, RestoreState]
type = ChangeState
trigger1 = power <= 0 || Win || Lose
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Braço
[Statedef 3301]
type    = S
movetype= I
physics = S
juggle  = 4
velset = 0,0
anim = 3301
ctrl = 0
sprpriority = 2

[State 3301, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Angulo = %f Px = %f Py = %f"
params = fvar(1),2.0*(Cos(fvar(1)*PI/180)),-2.0*(Sin(fvar(1)*Pi/180))

[State 3301, BindToParent]
type = BindToParent
trigger1 = 1
time = 1
facing = 1
pos = (1*facing)*Const(size.xscale),-36*Const(size.yscale)

[State 3301, Cima]
type = VarAdd
trigger1 = command = "holdup" && fvar(1) < 90 && !var(59)
trigger2 = fvar(1) < 90 && parent, var(59) && var(1) = -1
fv = 1
value = 1

[State 3301, Baixo]
type = VarAdd
trigger1 = command = "holddown" && fvar(1) > -90 && !var(59)
trigger2 = fvar(1) > -90 && parent, var(59) && var(1) = 1
fv = 1
value = -1

[State 3301, IA]
type = VarSet
triggerall = parent, var(59) && Alive && roundstate = 2 && power > 0
trigger1 = var(1) = 0
v = 1
value = ifelse(random < 500,1,-1)

[State 3301, IA]
type = VarSet
triggerall = parent, var(59) && Alive && roundstate = 2 && power > 0
trigger1 = var(1) = 1 && fvar(1) <= -90
v = 1
value = -1

[State 3301, IA]
type = VarSet
triggerall = parent, var(59) && Alive && roundstate = 2 && power > 0
trigger1 = var(1) = -1 && fvar(1) >= 90
v = 1
value = 1

[State 3301, SubPower]
type = PowerAdd
trigger1 = power > 0 && command = "holdx"
value = -2

[State 3301, Desenhar ângulo]
type = AngleSet
trigger1 = 1
value = fvar(1)

[State 3301, AngleDraw]
type = AngleDraw
trigger1 = 1

[State 3301, StateTypeSet]
type = StateTypeSet
trigger1 = command = "holdx"
statetype = S
movetype = A

[State 3301, StateTypeSet]
type = StateTypeSet
trigger1 = command != "holdx"
statetype = S
movetype = I

[State 3301, PlaySnd]
type = PlaySnd
trigger1 = command = "holdx" && time % 21 = 0
value = S3301,0

[State 3301, Projectile]
type = Projectile
trigger1 = !(time % 3) && command = "holdx"
ProjID = 3300
projanim = 3302
projscale = Const(size.xscale),Const(size.yscale)
velocity = 2.0*(Cos(fvar(1)*PI/180)),-2.0*(Sin(fvar(1)*Pi/180))
accel = 0,0
projhits = 100
projremovetime = 60
projpriority = 1
projsprpriority = 3
projedgebound = 40
projstagebound = 40
projheightbound = -240
offset = (ifelse(fvar(1) >= 0,5,-2)+sin(((90)+fvar(1))*PI/180)*24)* Const(size.xscale),(5+cos(((90)+fvar(1))*PI/180)*20) * Const(size.yscale)
;offset = sin(((90)+fvar(1))*PI/180)*28*Const(size.xscale),(cos(((90)+fvar(1))*PI/180)*(28)) * Const(size.yscale)
postype = p1         ;p2,front,back,left,right
projshadow = 0,0,0
; HitDef
attr = S,SP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAFD        ;HLAFD+-
guardflag = MA         ;HLA
getpower = 0,0
givepower = 20,0
animtype = Medium          ;light,medium,hard,back,up,diagup
air.animtype = Medium
priority = 4,Hit   ;Hit,Miss,Dodge
damage = 2,0
guard.pause = 0,0
sparkno = 0
guard.sparkno = 0
sparkxy = 0,0
hitsound = 0,0
fall = 0
guardsound = 0,0
ground.type = Trip      ;Low,Trip,None
ground.velocity = -2.0*(Cos(fvar(1)*PI/180)),-2.0*(Sin(fvar(1)*Pi/180))
air.velocity = -2.0*(Cos(fvar(1)*PI/180)),-2.0*(Sin(fvar(1)*Pi/180))
palfx.time = 15
palfx.mul = 256,128,256
palfx.add = 256,ifelse(random < 500, 256, 0),0

[State 3301, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

[State 3301, RestoreState]
type = DestroySelf
trigger1 = parent, power <= 0
trigger2 = parent, stateno != 3300 && parent, stateno != 3302 && parent, stateno != 999

[Statedef 3302]
type    = S
movetype= H
physics = S
velset = 0,0
ctrl = 0
sprpriority = 2

[State 3302, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
slot = 1
stateno = 3302
time = 1
forceair = 0

[State 3302, PowerAdd]
type = PowerAdd
trigger1 = GetHitVar(Damage) > 0
value = -(GetHitVar(Damage)*(PowerMax / 1000))
persistent = 0

[State 3302, PalFX]
type = PalFX
trigger1 = Time = 0
time = 15
add = 256,256,256
mul = 256,256,256
invertall = 0
color = 256

[State 3302, RestoreState]
type = ChangeState
trigger1 = 1
value = ifelse(!var(2),3300,ifelse(Pos Y < 0, 50,0))
ctrl = ifelse(!var(2),0,1)

; Ice Shield
[Statedef 3400]
type    = S
movetype= A
physics = S
velset = 0,0
ctrl = 0
anim = 0
sprpriority = 1

[State 3400, VarAdd]
type = VarAdd
trigger1 = time = 0
v = 57
value = 0

[State 3400, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3400, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time = 0
value = 999

[State 3400, Helper]
type = Helper
trigger1 = prevstateno = 999; && time % 40 = 0
helpertype = normal ;player
name = "Ice Shield"
ID = 3400+var(57)
stateno = 3401
pos = floor(((cos(((90)+var(57))*PI/180)*30)) * Const(size.xscale)), floor(((sin(((90)+var(57))*PI/180)*30)-15) * Const(size.yscale))
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
size.xscale = Const(size.xscale)
size.yscale = Const(size.yscale)
;persistent = 100

[State 3400, VarAdd]
type = VarAdd
trigger1 = var(57) <= 360
v = 57
value = 30

[State 3400, RestoreState]
type = ChangeState
trigger1 = var(57) > 360
value = 0
ctrl = 1

; Ice Shield (Literalmente)
[Statedef 3401]
type    = S
movetype= A
physics = S
anim = 3400
velset = 0,0
ctrl = 0
sprpriority = 5

[State 3401, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "var(15) = %d Retornou X = %f"
params = var(15), fvar(15)

[State 201, Explod]
type = Explod
trigger1 = time % 10 = 0
anim = 4106
ID = 4106
pos = 0,0
vel = 0, 1
postype = p1  ;p2,front,back,left,right
scale = Const(size.xscale), Const(size.yscale)
sprpriority = -1
ownpal = 1
removeongethit = 0
ignorehitpause = 1


[State 3401, VarAdd]
type = VarAdd
trigger1 = 1
v = 15
value = 5

[State 3401, AngleSet]
type = VarSet
trigger1 = time = 0
v = 15
value = root, var(57)
ignorehitpause = 1

[State 3401, AngleAdd]
type = AngleSet
trigger1 = 1
value = var(15)

[State 3401, AngleDraw]
type = AngleDraw
trigger1 = 1

[State 3401, VarSet]
type = VarSet
trigger1 = 1
fv = 15
value = ((cos(((90)+var(15))*PI/180)*30)) * Const(size.xscale)


[State 3401, VarSet]
type = VarSet
trigger1 = 1
fv = 16
value = ((sin(((90)+var(15))*PI/180)*30)-15) * Const(size.yscale)

[State 3401, BindToParent]
type = BindToRoot
trigger1 = 1
pos = fvar(15), fvar(16)

[State 3401, 4]
type = HitDef
trigger1 = 1
attr = S, HA
animtype  = Hard
damage    = 10,1
givepower  = 15,15
priority  = 6
guardflag = MA
pausetime = 0,90
sparkxy = 0,0
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -18,0
air.velocity = -18,0
p2stateno = 1000
palfx.time = 25
palfx.add = 0, 64, 128
fall.animtype = Hard
fall.recover = 0
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
p2facing = 1                 ;Force p2 to face p1 on hit
fall = 1
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 70             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15

[State 3401, DestroySelf]
type = DestroySelf
trigger1 = movecontact || time > 500

;---------------------------------------------------------------------------
; Shield
[Statedef 3500]
type    = S
movetype= I
physics = S
juggle  = 4
velset = 0,0
anim = 3500
ctrl = 0
sprpriority = 2

[State 3500, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3500, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3500, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT

[State 3500, BGPalFX]
type = BGPalFX
trigger1 = animelemno(1) = 3
time = 25
sinadd = 256,256,256,50
color = 256

[State 3500, VarSet]
type = VarSet
trigger1 = prevstateno = 999
v = 2
value = 1

[State 3500, RestoreState]
type = ChangeState
trigger1 = prevstateno = 999 && time > 100
value = ifelse(Pos Y >= 0, 0, 50)
ctrl = 1

; Speed Booster
[Statedef 3600]
type    = S
movetype= A
physics = S
velset = 0,0
anim = 43
ctrl = 0

[State 3600, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0

[State 3600, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3600, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time > 1
value = 999

[State 3600, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

[State 3600, PlaySnd]
type = PlaySnd
trigger1 = var(28) > 0
value = 3000,0
volume = 0
channel = 3
loop = 1
persistent = 0

[State 3600, PalFX]
type = PalFX
trigger1 = var(28) > 0
time = 2
add = 0,128,256
mul = 256,256,256
invertall = 0
color = 256

[State 3600, AfterImage]
type = AfterImage
trigger1 = var(28) > 0
time = 25
length = 15
PalBright  = 0,128,256
palcontrast = 0,128,256
palpostbright = 0,128,256
paladd = 0,64,128
persistent = 0

[State 3600, AfterImageTime]
type = AfterImageTime
trigger1 = 1
time = 5

[State 3600, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0

[State 3600, VarSet]
type = VarSet
trigger1 = time = 0
v = 51
value = -1000

[State 3600, StateFx]
type = ChangeState
trigger1 = prevstateno != 999 && time = 0
value = 999

[State 3600, VarSet]
type = VarSet
trigger1 = prevstateno = 999 && time = 0
v = 28
value = 0

[State 3600, VelSet]
type = VelSet
trigger1 = var(28) = 0
x = Const(velocity.run.back.x)
y = Const(velocity.run.back.y)

[State 3600, Gravity]
type = Gravity
trigger1 = Pos Y < 0 && var(28) = 0

[State 3600, VarSet]
type = VarSet
trigger1 = BackEdgeDist < -60 && var(28) = 0
v = 28
value = 1

[State 3600, PosSet]
type = PosSet
trigger1 = var(28) > 0 && var(28) <= 3
x = pos X
y = 0

[State 3600, ChangeAnim]
type = VelSet
trigger1 = var(28) > 0 && var(28) <= 3
x = 10
y = 0

[State 3050, 2]
type = Helper
helpertype = normal
trigger1 = var(28) = 3 && time % 5 = 0
id = 249
name = "Weak Power Bomb"
postype = player
pos = 0, 0
stateno = 3051
keyctrl = 0
ownpal = 1
sprpriority = 10

[State 3600, StopSnd]
type = StopSnd
trigger1 = var(28) > 3
channel = 3
persistent = 0

[State 3600, ChangeState]
type = ChangeState
trigger1 = var(28) > 3
value = 0
ctrl = 1


[State 3600, ChangeAnim]
type = ChangeAnim
trigger1 = Pos Y = 0 && var(28) = 1
value = 3600
;elem = 1
;ignorehitpause =
persistent = 0

[State 3600, ChangeAnim]
type = ChangeAnim
trigger1 = Pos Y = 0 && var(28) = 3
value = 165
;elem = 1
;ignorehitpause =
persistent = 0

[State 3600, VarAdd]
type = VarAdd
trigger1 = FrontEdgeDist < -60
v = 28    ;fv =
value = 1

[State 3600, Turn]
type = Turn
trigger1 = FrontEdgeDist < -60

[State 3600, 4]
type = HitDef
trigger1 = stateno = 3600
attr = S, HA
hitflag = HLAFD
animtype  = Hard
damage    = 5,1
getpower  = 0
priority  = 6
guardflag = HA
pausetime = 0,0
sparkxy = 19,-13
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -18,-6
air.velocity = -18,-6
air.fall = 1
palfx.time = 25
palfx.add = 255, 0, 0
fall.animtype = Hard
fall.recover = 0
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
p2facing = 1                 ;Force p2 to face p1 on hit
fall = 1
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 70             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15

; Samus's Last Breath
; Aqui Samus tem a última chance de conseguir ganhar do oponente
; Ela não morrerá, irá sugar seu power bar para conseguir life
; mas não conseguirá mais carregar power
[Statedef 3666]
type = U
movetype = H
physics = N
ctrl = 0

;[State 3666, ChangeState]
;type = ChangeState
;trigger1 = prevstateno != 999 && time = 0
;value = 999
;ignorehitpause = 1

[State 3666, AfterImage]
type = AfterImage
trigger1 = roundstate = 2
time = 2
length = 20
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 120,20,124
paladd = 60,10,10
palmul = .65,.65,.75
;timegap = 1
framegap = 3
;trans = "add" ;"none","add1","sub"
ignorehitpause = 1
persistent = 0

[State 3666, AfterImageTime]
type = AfterImageTime
trigger1 = roundstate = 2
time = 2

[State 3666, AssertSpecial]
type = AssertSpecial
trigger1 = power > 0
flag = roundnotover
persistent = 1

[State 3666, StateTypeSet]
type = StateTypeSet
trigger1 = Pos Y < 0
statetype = A       ;S,A,C,L
movetype = H        ;I,A,H
physics = A         ;A,C,S,N
ignorehitpause = 1

[State 3666, StateTypeSet]
type = StateTypeSet
trigger1 = Pos Y >= 0
statetype = S       ;S,A,C,L
movetype = H        ;I,A,H
physics = S         ;A,C,S,N
ignorehitpause = 1

[State 3666, ChangeAnim]
type = ChangeAnim
trigger1 = Pos Y < 0 && anim != 41
value = 41

[State 3666, ChangeAnim]
type = ChangeAnim
trigger1 = Pos Y >= 0 && anim != 5300
value = 5300

[State 3666, VelSet]
type = VelSet
trigger1 = Pos Y > 0
x = 0
y = 0

[State 3666, PosSet]
type = PosSet
trigger1 = Pos Y > 0
x = Pos X
y = 0
persistent = 1

[State 3666, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1
ignorehitpause = 1
persistent = 1

;[State 3666, ChangeState]
;type = ChangeState
;trigger1 = Pos Y <= 0 && prevstateno != 3100
;value = 3100

;Generated by Fighter Factory PalFX Editor
[State 3666, PalFXWiz]
type = PalFX
trigger1 = 1
time = power / 3
add = 0,0,256
mul = 256,256,256
sinadd = 64,64,256,50
invertall = 0
color = 128
;ignorehitpause = 0
persistent = 0


[State 3666, LifeAdd]
type = LifeAdd
trigger1 = power > 0 && Pos Y >= 0
value = 2

[State 3666, PowerAdd]
type = PowerAdd
trigger1 = power > 0 && Pos Y >= 0
value = -(PowerMax/1000)*2

[State 3666, VarSet]
type = VarSet
trigger1 = power <= 0 || life >= LifeMax
v = 4
value = 1

[State 3500, RestoreState]
type = ChangeState
trigger1 = var(4)
trigger2 = roundstate != 2
value = ifelse(Pos Y >= 0, 12, 50)
ctrl = 1

[Statedef 5666]
type = S
movetype = I
physics = N
;anim = 5000
velset = 0, 0

[State 5666, AssertSpecial]
type = AssertSpecial
trigger1 = 1
ignorehitpause = 1
flag = nokoslow

[State 5666, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = roundnotover
flag2 = intro
flag3 = nobardisplay
ignorehitpause = 1

[State 5666, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nomusic
flag2 = nobg
flag3 = nofg
ignorehitpause = 1

[State 5666, Pause]
type = Pause
trigger1 = time % 2 = 0
time = 3
movetime = 3
ignorehitpause = 1
pausebg = 1

[State 5666, VelSet]
type = VelSet
trigger1 = 1
x = floor((ScreenPos X-160) * (-Facing))
y = floor(-(ScreenPos Y-160))
ignorehitpause = 1

[State 5666, VelMul]
type = VelMul
trigger1 = 1
x = ifelse(name = "Samus Aran by endoedgarjunior", 0.05, 0.23)
y = ifelse(name = "Samus Aran by endoedgarjunior", 0.05, 0.23)

[State 5666, SprPriority]
type = SprPriority
trigger1 = 1
value = 5
ignorehitpause = 1

[State 5666, Explod]
type = Explod
trigger1 = 1
anim = 3666
ID = 3666+ID
pos = floor(-ScreenPos X-160),floor(-ScreenPos Y)
postype = p1
facing = 1
vfacing = 1
bindtime = 1
vel = 0,0
accel = 0,0
random = 0,0
removetime = 1
supermove
pausemove
scale = 2,2
sprpriority = 5
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0
ignorehitpause = 1
persistent = 0

[State 5666, ModifyExplod]
type = ModifyExplod
trigger1 = 1
ID = 3666+ID
pos = floor(-ScreenPos X-160),floor(-ScreenPos Y)
postype = p1
removetime = 1
supermove
pausemove
scale = 3,3
ignorehitpause = 1

[State 5666, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0
ignorehitpause = 1

[State 100, Sombras =P]
type = Afterimage
trigger1 = !time && name != "Samus Aran by endoedgarjunior"
time = -1
length = 8
PalBright = 0,0,0
PalContrast = 225,255,255
PalAdd = 0,0,0
PalMul = 1,1,1
FrameGap = 3

[State 5666, BGPalFX]
type = Varadd
trigger1 = anim = 5140 && animelemno(0) >= 2 && var(17) < 256
V = 17
value = 5

[State 5666, Envcolor]
type = AllPalFX
trigger1 = anim = 5140 && animelemno(0) >= 2
add = var(17),var(17),var(17)
color = 256
time = 1

[State 5666, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "vel x = %d (%f) vel y = %d (%f)"
params = floor(vel x),vel x,floor(vel y), vel y
ignorehitpause = 1

[State 5666, ChangeAnim]
type = ChangeAnim
trigger1 = abs(vel x) > 0.3 && abs(vel y) > 0.3 && name = "Samus Aran by endoedgarjunior"
value = ifelse(name = "Samus Aran by endoedgarjunior", anim, 5141)
elem = ifelse(name = "Samus Aran by endoedgarjunior", animelemno(0), 1)
ignorehitpause = 1

[State 5666, ChangeAnim]
type = ChangeAnim
trigger1 = abs(vel x) <= 0.3 && abs(vel y) <= 0.3 && anim != 5140 && name = "Samus Aran by endoedgarjunior"
trigger2 = name != "Samus Aran by endoedgarjunior" && anim != 5140
value = 5140

[State 5666, PlaySnd]
type = PlaySnd
trigger1 = abs(vel x) <= 0.3 && abs(vel y) <= 0.3 && name = "Samus Aran by endoedgarjunior"
trigger2 = name != "Samus Aran by endoedgarjunior" && anim = 5140
value = S5150,0
ignorehitpause = 1
persistent = 0

[State 5150, PalFX]
type = PalFX
trigger1 = time % (2) && anim = 5140 && animelemno(0) <= 2
time = 1
add = 256,256,256
mul = 256,256,256
;sinadd = 0,0,0,10
invertall = 0
color = 256
ignorehitpause = 1
;persistent =

[State 3666, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0

[State 3666, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
value2 = S,NA
time = 1

[State 5666, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0 && anim = 5140
value = 5150

; Machine Gun Attack
[Statedef 3700]
type    = S
movetype= A
physics = S
anim = 3700
ctrl = 0

;[State 3700, StateFx]
;type = ChangeState
;trigger1 = prevstateno != 999 && time > 1
;value = 999

[State 3700, PalFX]
type = PalFX
trigger1 = animelemno(1) = 1
time = 5
add = 0,0,0
mul = 256,256,256
sinadd = 64,64,64,5
invertall = 0
color = 256
ignorehitpause = 1
;persistent =


[State 3700, SuckEnergy]
type = PowerAdd
trigger1 = power > 0 && time % 5 = 0
value = -80

[State 3700, PlaySnd]
type = PlaySnd
trigger1 = time % 5 = 0
value = 3700,0
volume = 0
air.juggle = 1
fall = 0

[State 3700, Projectile]
type = Projectile
trigger1 = time % 5 = 0
ProjID = 3700
projanim = 3701
projhitanim = -1
projremanim = -1
projcancelanim = -1
projscale = Const(size.xscale),Const(size.yscale)
velocity = (random%5)+20,(((random % 3) - 1)*1000)/1000.0
projremovetime = 100
remvelocity = 0,0
velmul = 0.95
projmiss = 0
projpriority = 0
projsprpriority = 3
projedgebound = 40
projstagebound = 40
projheightbound = -240
offset = 13*Const(size.xscale),-26*Const(size.yscale)
postype = p1         ;p2,front,back,left,right
projshadow = 0,0,0
hitflag = MAFDP
attr = S, SP
guardflag = MA
guardsound = S270, 0
ground.type = Trip
ground.slidetime = 14
ground.hittime = 16
air.type = Trip
air.velocity = -2.5,-1.4
air.juggle = 1
fall = 1
animtype = Light          ;light,medium,hard,back,up,diagup
air.animtype = Light
sparkno = S4100
guard.sparkno = S4103
damage = 1, 0

[State 3700, RestoreState]
type = ChangeState
triggerall = time > 5
trigger1 = power <= 0
trigger2 = var(59) && ProjHit3700 = 0, < 10
trigger3 = !var(59) && Command != "holdc"
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Chama Clone
;[Statedef 3900]
;type    = S
;movetype= I
;physics = S
;juggle  = 4
;velset = 0,0
;anim = 3500
;ctrl = 0
;sprpriority = 2

;[State 3900, VarSet]
;type = VarSet
;trigger1 = time = 0
;v = 51
;value = -1000

;[State 3900, StateFx]
;type = ChangeState
;trigger1 = prevstateno != 999 && time > 1
;value = 999

;[State 3900, NotHitBy]
;type = NotHitBy
;trigger1 = 1
;value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT

;[State 3900, BGPalFX]
;type = BGPalFX
;trigger1 = animelemno(1) = 3
;time = 25
;sinadd = 256,256,256,50
;color = 256

;[State 3900, Clone]
;type = Helper
;triggerall = roundstate = 2
;trigger1 = numhelper(9) <= 1
;helpertype = player ;normal
;name = "SA-X"
;ID = 9
;stateno = 0
;pos = floor(Pos X), floor(Pos Y - 1000)
;postype = p1    ;p2,front,back,left,right
;keyctrl = 1
;ownpal = 1
;persistent = 1

;[State 3900, RestoreState]
;type = ChangeState
;trigger1 = prevstateno = 999 && time > 100
;value = ifelse(Pos Y >= 0, 0, 50)
;ctrl = 1

; That's all folks

[StateDef 9741]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 9741, Safety]; Just in case your opponent is very poorly coded.
type = SelfState
trigger1 = !IsHelper
value = 5050

[State 9741, UglyHack]
type = VarSet
trigger1 = !var(1)
var(2) = 2

[State 9741, PauseCheck]
type = VarSet
trigger1 = GameTime > Parent,var(57)
trigger2 = !(Parent,Alive)
trigger3 = RoundState != 2
trigger4 = Parent,var(58)
trigger5 = var(3):=0
var(2) = (var(3):=1)+(var(4):=0)

[State 9741, Facing]
type = Turn
trigger1 = var(9):=(Facing != Parent,Facing)
trigger1 = !(var(4):=0)

[State 9741, DirTurnOnAI]
type = ParentVarSet
triggerall = !(var(3) || var(9))
trigger1 = Parent,command = "holdfwd"
trigger2 = Parent,command = "holdback"
trigger3 = Parent,command = "holdup"
trigger4 = Parent,command = "holddown"
trigger5 = !(var(4):=1)
var(58) = var(4)

[State 9741, DirTurnOffAI]
type = ParentVarSet
triggerall = !var(3)
triggerall = Parent,var(58)
trigger1 = command = "holdfwd"
trigger1 = Parent,command = "holdfwd"
trigger2 = command = "holdback"
trigger2 = Parent,command = "holdback"
trigger3 = command = "holdup"
trigger3 = Parent,command = "holdup"
trigger4 = command = "holddown"
trigger4 = Parent,command = "holddown"
var(58) = var(4):=0

[State 9741, ButtonTurnOnAI]
type = ParentVarSet
triggerall = !var(2)
trigger1 = Parent,command = "a"
trigger2 = Parent,command = "b"
trigger3 = Parent,command = "c"
trigger4 = Parent,command = "x"
trigger5 = Parent,command = "y"
trigger6 = Parent,command = "z"
trigger7 = Parent,command = "start"
var(58) = 1

[State 9741, ButtonTurnOffAI]
type = ParentVarSet
triggerall = !var(2)
trigger1 = command = "a"
trigger1 = Parent,command = "a"
trigger2 = command = "b"
trigger2 = Parent,command = "b"
trigger3 = command = "c"
trigger3 = Parent,command = "c"
trigger4 = command = "x"
trigger4 = Parent,command = "x"
trigger5 = command = "y"
trigger5 = Parent,command = "y"
trigger6 = command = "z"
trigger6 = Parent,command = "z"
trigger7 = command = "start"
trigger7 = Parent,command = "start"
var(58) = -1

[State 9741, UnPauseCheck]
type = VarSet
triggerall = var(2)
trigger1 = Parent,command = "a"
trigger2 = Parent,command = "b"
trigger3 = Parent,command = "c"
trigger4 = Parent,command = "x"
trigger5 = Parent,command = "y"
trigger6 = Parent,command = "z"
trigger7 = Parent,command = "start"
trigger8 = var(2) = 2
trigger8 = var(2):=0
var(2) = 2

[State 9741, Goodbye]
type = DestroySelf
triggerall = var(1):=1
trigger1 = Parent,var(58)
trigger2 = !(Parent,Alive)
trigger3 = RoundState != 2


;------------------
; AI Activation Helper State - Compatibly Partnered Version
[StateDef 9742]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 9742, Safety]; Just in case your opponent is very poorly coded.
type = SelfState
trigger1 = !IsHelper
value = 5050

[State 9742, UglyHack]
type = VarSet
trigger1 = !var(1)
var(2) = var(3):=2

[State 9742, PauseCheck]
type = VarSet
trigger1 = GameTime > Parent,var(57)
trigger2 = !(Parent,Alive)
trigger3 = RoundState != 2
trigger4 = Parent,var(58)
trigger5 = var(1)
trigger5 = var(3):=0
var(2) = var(3):=1

[State 9742, Facing]
type = Turn
trigger1 = var(9):=(Facing != Parent,Facing)

[State 9742, ParentDirCheck]
type = VarSet
trigger1 = Parent,command = "holdfwd"
trigger2 = Parent,command = "holdback"
trigger3 = Parent,command = "holdup"
trigger4 = Parent,command = "holddown"
trigger5 = var(6):=0
var(6) = 1

[State 9742, BufferCheck]
type = VarSet
trigger1 = var(3) || var(4) || var(10)
var(10) = var(6)

[State 9742, ParentButtonCheck]
type = VarSet
trigger1 = Parent,command = "a"
trigger2 = Parent,command = "b"
trigger3 = Parent,command = "c"
trigger4 = Parent,command = "x"
trigger5 = Parent,command = "y"
trigger6 = Parent,command = "z"
trigger7 = Parent,command = "start"
trigger8 = var(7):=0
var(7) = 1

[State 9742, SameButtonCheck]
type = VarSet
triggerall = var(7)
triggerall = !var(2)
triggerall = NumPartner
trigger1 = Parent,command = "a"
trigger1 = Partner,command = "a"
trigger2 = Parent,command = "b"
trigger2 = Partner,command = "b"
trigger3 = Parent,command = "c"
trigger3 = Partner,command = "c"
trigger4 = Parent,command = "x"
trigger4 = Partner,command = "x"
trigger5 = Parent,command = "y"
trigger5 = Partner,command = "y"
trigger6 = Parent,command = "z"
trigger6 = Partner,command = "z"
trigger7 = Parent,command = "start"
trigger7 = Partner,command = "start"
trigger8 = var(8):=0
var(8) = 1

[State 9742, DirTurnOnAI]
type = ParentVarSet
trigger1 = var(6)
trigger1 = !(var(9) || var(10))
var(58) = 1

[State 9742, DirTurnOffAI]
type = ParentVarSet
triggerall = var(6)
triggerall = !var(3)
triggerall = Parent,var(58)
trigger1 = command = "holdfwd"
trigger1 = Parent,command = "holdfwd"
trigger2 = command = "holdback"
trigger2 = Parent,command = "holdback"
trigger3 = command = "holdup"
trigger3 = Parent,command = "holdup"
trigger4 = command = "holddown"
trigger4 = Parent,command = "holddown"
var(58) = 0

[State 9742, ButtonTurnOnAI]
type = ParentVarSet
trigger1 = var(5) && var(7)
trigger1 = !(var(2) || var(8))
var(58) = 1

[State 9742, ButtonTurnOffAI]
type = ParentVarSet
triggerall = var(7)
triggerall = !(var(2) || var(8))
trigger1 = command = "a"
trigger1 = Parent,command = "a"
trigger2 = command = "b"
trigger2 = Parent,command = "b"
trigger3 = command = "c"
trigger3 = Parent,command = "c"
trigger4 = command = "x"
trigger4 = Parent,command = "x"
trigger5 = command = "y"
trigger5 = Parent,command = "y"
trigger6 = command = "z"
trigger6 = Parent,command = "z"
trigger7 = command = "start"
trigger7 = Parent,command = "start"
var(58) = -1

[State 9742, UnPauseCheck]
type = VarSet
triggerall = var(2)
triggerall = !var(4)
trigger1 = var(7)
trigger2 = var(2) = 2
trigger2 = var(2):=0
var(2) = 2

[State 9742, Goodbye]
type = DestroySelf
trigger1 = Parent,var(58)
trigger2 = !(Parent,Alive)
trigger3 = RoundState != 2

[State 9742, HitPauseCheck]
type = VarSet
trigger1 = var(6) || var(7)
trigger2 = !(Parent,HitPauseTime)
var(4) = Parent,HitPauseTime

[State 9742, Delay]
type = VarSet
trigger1 = var(1):=1
var(5) = !var(7)
